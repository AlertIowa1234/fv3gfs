<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Interoperable Physics Driver for NGGPS: GFS_driver.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ncep.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Interoperable Physics Driver for NGGPS
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_g_f_s__driver_8_f90_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GFS_driver.F90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_g_f_s__driver_8_f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html">    1</a></span>&#160;<span class="keyword">module</span> <a class="code" href="namespacegfs__driver.html">gfs_driver</a></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">use </span>machine<span class="keywordtype">,                  only</span>: kind_phys</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacegfs__typedefs.html">gfs_typedefs</a><span class="keywordtype">,             only</span>: <a class="code" href="structgfs__typedefs_1_1gfs__init__type.html">gfs_init_type</a>,                       &amp;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;                                      <a class="code" href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_statein_type</a>, <a class="code" href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_stateout_type</a>, &amp;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;                                      <a class="code" href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_sfcprop_type</a>, <a class="code" href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_coupling_type</a>, &amp;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                                      <a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>, <a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>,     &amp;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;                                      <a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>,     <a class="code" href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_cldprop_type</a>,  &amp;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                                      <a class="code" href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_radtend_type</a>, <a class="code" href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_diag_type</a></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacemodule__radiation__driver.html">module_radiation_driver</a><span class="keywordtype">,  only</span>: <a class="code" href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a">gfs_radiation_driver</a>, <a class="code" href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">radupdate</a></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacemodule__physics__driver.html">module_physics_driver</a><span class="keywordtype">,    only</span>: <a class="code" href="namespacemodule__physics__driver.html#a13c7ad66034ebcbe6f77208d83ac54da">gfs_physics_driver</a></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="keywordtype">use </span>module_radsw_parameters<span class="keywordtype">,  only</span>: topfsw_type, sfcfsw_type</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keywordtype">use </span>module_radlw_parameters<span class="keywordtype">,  only</span>: topflw_type, sfcflw_type</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="keywordtype">use </span>funcphys<span class="keywordtype">,                 only</span>: gfuncphys</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keywordtype">use </span>gfdl_cloud_microphys_mod<span class="keywordtype">, only</span>: gfdl_cloud_microphys_init</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keywordtype">use </span>physcons<span class="keywordtype">,                 only</span>: gravit =&gt; con_g,    rair    =&gt; con_rd, &amp;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                                      rh2o   =&gt; con_rv,                      &amp;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                                      tmelt  =&gt; con_ttp,  cpair   =&gt; con_cp, &amp;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                                      latvap =&gt; con_hvap, latice  =&gt; con_hfus</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keywordtype">private</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">!--------------------------------------------------------------------------------</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">! GFS_init_type</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">!--------------------------------------------------------------------------------</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">!   This container is the minimum set of data required from the dycore/atmosphere</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">!   component to allow proper initialization of the GFS physics</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">!  </span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">!   Type is defined in GFS_typedefs.F90</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">!--------------------------------------------------------------------------------</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">! type GFS_init_type</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">!   public</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">!   integer :: me                                !&lt; my MPI-rank</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">!   integer :: master                            !&lt; master MPI-rank</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">!   integer :: isc                               !&lt; starting i-index for this MPI-domain</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">!   integer :: jsc                               !&lt; starting j-index for this MPI-domain</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">!   integer :: nx                                !&lt; number of points in i-dir for this MPI rank</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">!   integer :: ny                                !&lt; number of points in j-dir for this MPI rank</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">!   integer :: levs                              !&lt; number of vertical levels</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">!   integer :: cnx                               !&lt; number of points in i-dir for this cubed-sphere face</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">!                                                !&lt; equal to gnx for lat-lon grids</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">!   integer :: cny                               !&lt; number of points in j-dir for this cubed-sphere face</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">!                                                !&lt; equal to gny for lat-lon grids</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">!   integer :: gnx                               !&lt; number of global points in x-dir (i) along the equator</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">!   integer :: gny                               !&lt; number of global points in y-dir (j) along any meridian</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">!   integer :: nlunit                            !&lt; fortran unit number for file opens</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">!   integer :: logunit                           !&lt; fortran unit number for writing logfile</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">!   integer :: dt_dycore                         !&lt; dynamics time step in seconds</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">!   integer :: dt_phys                           !&lt; physics  time step in seconds</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">!   integer :: bdat(8)                           !&lt; model begin date in GFS format   (same as idat)</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">!   integer :: cdat(8)                           !&lt; model current date in GFS format (same as jdat)</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">!   !--- blocking data</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">!   integer, pointer :: blksz(:)                 !&lt; for explicit data blocking</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">!                                                !&lt; default blksz(1)=[nx*ny]</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">!   !--- ak/bk for pressure level calculations</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">!   integer, pointer :: ak(:)                    !&lt; from surface (k=1) to TOA (k=levs)</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">!   integer, pointer :: bk(:)                    !&lt; from surface (k=1) to TOA (k=levs)</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">!   !--- grid metrics</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">!   real(kind=kind_phys), pointer :: xlon(:,:)   !&lt; column longitude for MPI rank</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">!   real(kind=kind_phys), pointer :: xlat(:,:)   !&lt; column latitude  for MPI rank</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">!   real(kind=kind_phys), pointer :: area(:,:)   !&lt; column area for length scale calculations</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">!   character(len=32), pointer :: tracer_names(:) !&lt; tracers names to dereference tracer id</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">!                                                 !&lt; based on name location in array</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">!   character(len=65) :: fn_nml                  !&lt; namelist filename</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">!   character(len=*), pointer :: input_nml_file(:) !&lt; character string containing full namelist</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">!                                                  !&lt; for use with internal file reads</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">! end type GFS_init_type</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">!--------------------------------------------------------------------------------</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">!------------------</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">! Module parameters</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">!------------------</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">!----------------------------</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">! Module variable definitions</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">!----------------------------</span></div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#a361be517e7eafe75c98c0676d08468d3">   80</a></span>&#160;  <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacegfs__driver.html#a361be517e7eafe75c98c0676d08468d3">con_24</a>  =   24.0_kind_phys</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">   81</a></span>&#160;  <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">con_hr</a>  = 3600.0_kind_phys</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#a741fe74ab1500b05fa747a711e74610e">   82</a></span>&#160;  <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacegfs__driver.html#a741fe74ab1500b05fa747a711e74610e">con_99</a>  =   99.0_kind_phys</div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#ac7e929b29814a67e0c2d8f59b7a8f7ef">   83</a></span>&#160;  <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacegfs__driver.html#ac7e929b29814a67e0c2d8f59b7a8f7ef">con_100</a> =  100.0_kind_phys</div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#a1dc506e00472176743d287ee18bb19c1">   84</a></span>&#160;  <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacegfs__driver.html#a1dc506e00472176743d287ee18bb19c1">qmin</a>    =    1.0e-10</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">   86</a></span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: <a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>(:)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">!----------------</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">! Public entities</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">!----------------</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordtype">public</span>  <a class="code" href="namespacegfs__driver.html#aa53fa4a0921c4443630976402933ff44">gfs_initialize</a>              </div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordtype">public</span>  <a class="code" href="namespacegfs__driver.html#ad673b930d2e2319a99586ec2232ebea0">gfs_time_vary_step</a>          </div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordtype">public</span>  <a class="code" href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a">gfs_radiation_driver</a>        </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">public</span>  <a class="code" href="namespacemodule__physics__driver.html#a13c7ad66034ebcbe6f77208d83ac54da">gfs_physics_driver</a>          </div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">public</span>  <a class="code" href="namespacegfs__driver.html#a913f6dc554990798c132f51cf053b2fb">gfs_stochastic_driver</a>       </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keyword">CONTAINS</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">!*******************************************************************************************</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">!--------------</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">! GFS initialze</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">!--------------</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="namespacegfs__driver.html#aa53fa4a0921c4443630976402933ff44">gfs_initialize</a> (Model, Statein, Stateout, Sfcprop,     &amp;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                             Coupling, Grid, Tbd, Cldprop, Radtend, &amp; </div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                             Diag, Init_parm)</div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#aa53fa4a0921c4443630976402933ff44">  108</a></span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">!   use module_microphysics, only: gsmconst</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordtype">use </span>cldwat2m_micro<span class="keywordtype">,      only</span>: ini_micro</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordtype">use </span>micro_mg2_0<span class="keywordtype">,         only</span>: micro_mg_init</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordtype">use </span>aer_cloud<span class="keywordtype">,           only</span>: aer_cloud_init</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">use </span>module_ras<span class="keywordtype">,          only</span>: ras_init</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">use </span>module_mp_thompson<span class="keywordtype">,  only</span>: thompson_init</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordtype">use </span>module_mp_wsm6<span class="keywordtype">,      only</span>: wsm6init</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">!--- interface variables</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>),   <span class="keywordtype">intent(inout)</span> :: Model</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_statein_type</a>),   <span class="keywordtype">intent(inout)</span> :: Statein(:)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_stateout_type</a>),  <span class="keywordtype">intent(inout)</span> :: Stateout(:)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_sfcprop_type</a>),   <span class="keywordtype">intent(inout)</span> :: Sfcprop(:)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_coupling_type</a>),  <span class="keywordtype">intent(inout)</span> :: Coupling(:)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>),      <span class="keywordtype">intent(inout)</span> :: Grid(:)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>),       <span class="keywordtype">intent(inout)</span> :: Tbd(:)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_cldprop_type</a>),   <span class="keywordtype">intent(inout)</span> :: Cldprop(:)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_radtend_type</a>),   <span class="keywordtype">intent(inout)</span> :: Radtend(:)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_diag_type</a>),      <span class="keywordtype">intent(inout)</span> :: Diag(:)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__init__type.html">gfs_init_type</a>),      <span class="keywordtype">intent(in)</span>    :: Init_parm</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">!--- local variables</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">integer</span> :: nb</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">integer</span> :: nblks</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">integer</span> :: ntrac</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">integer</span> :: ix</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">allocatable</span> :: si(:)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">parameter</span>   :: p_ref = 101325.0d0</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    nblks = <span class="keyword">size</span>(init_parm%blksz)</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    ntrac = <span class="keyword">size</span>(init_parm%tracer_names)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keyword">allocate</span> (<a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>(nblks))</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>(:) = init_parm%blksz(:)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">!--- initializing stochastic physics</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">!--- set control properties (including namelist read)</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">call </span>model%init (init_parm%nlunit, init_parm%fn_nml,           &amp;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                     init_parm%me, init_parm%master,               &amp;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                     init_parm%logunit, init_parm%isc,             &amp;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                     init_parm%jsc, init_parm%nx, init_parm%ny,    &amp;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                     init_parm%levs, init_parm%cnx, init_parm%cny, &amp;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                     init_parm%gnx, init_parm%gny,                 &amp;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                     init_parm%dt_dycore, init_parm%dt_phys,       &amp;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                     init_parm%bdat, init_parm%cdat,               &amp;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                     init_parm%tracer_names,                       &amp;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                     init_parm%input_nml_file)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keyword">call </span>init_stochastic_physics(model,init_parm)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span>(model%me == model%master) print*,<span class="stringliteral">&#39;do_skeb=&#39;</span>,model%do_skeb</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keyword">call </span>read_o3data  (model%ntoz, model%me, model%master)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keyword">call </span>read_h2odata (model%h2o_phys, model%me, model%master)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">do</span> nb = 1,nblks</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      ix = init_parm%blksz(nb)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">!     write(0,*)&#39; ix in gfs_driver=&#39;,ix,&#39; nb=&#39;,nb</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keyword">call </span>statein  (nb)%create (ix, model)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keyword">call </span>stateout (nb)%create (ix, model)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keyword">call </span>sfcprop  (nb)%create (ix, model)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keyword">call </span>coupling (nb)%create (ix, model)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keyword">call </span>grid     (nb)%create (ix, model)</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <span class="keyword">call </span>tbd      (nb)%create (ix, model)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keyword">call </span>cldprop  (nb)%create (ix, model)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keyword">call </span>radtend  (nb)%create (ix, model)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">!--- internal representation of diagnostics</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keyword">call </span>diag     (nb)%create (ix, model)</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">!--- populate the grid components</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacegfs__driver.html#a59f5e1e0612794f6801490d8d642b89b">gfs_grid_populate</a> (grid, init_parm%xlon, init_parm%xlat, init_parm%area)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;     </div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">!--- read in and initialize ozone and water</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">if</span> (model%ntoz &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="keywordflow">do</span> nb = 1, nblks</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keyword">call </span>setindxoz (init_parm%blksz(nb), grid(nb)%xlat_d, grid(nb)%jindx1_o3, &amp;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                        grid(nb)%jindx2_o3, grid(nb)%ddy_o3)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (model%h2o_phys) <span class="keywordflow">then</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">do</span> nb = 1, nblks</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keyword">call </span>setindxh2o (init_parm%blksz(nb), grid(nb)%xlat_d, grid(nb)%jindx1_h, &amp;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                         grid(nb)%jindx2_h, grid(nb)%ddy_h)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">!--- Call gfuncphys (funcphys.f) to compute all physics function tables.</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">call </span>gfuncphys ()</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">!   call gsmconst (Model%dtp, Model%me, .TRUE.) ! This is for Ferrier microphysics - notused - moorthi</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">!--- define sigma level for radiation initialization </span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">!--- The formula converting hybrid sigma pressure coefficients to sigma coefficients follows Eckermann (2009, MWR)</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">!--- ps is replaced with p0. The value of p0 uses that in http://www.emc.ncep.noaa.gov/officenotes/newernotes/on461.pdf</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">!--- ak/bk have been flipped from their original FV3 orientation and are defined sfc -&gt; toa</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">allocate</span>(si(model%levr+1))</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    si = (init_parm%ak + init_parm%bk * p_ref - init_parm%ak(model%levr+1)) &amp;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;             / (p_ref - init_parm%ak(model%levr+1))</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keyword">call </span>rad_initialize (si,   model%levr,         model%ictm,    model%isol,     &amp;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;           model%ico2,         model%iaer,         model%ialb,    model%iems,     &amp;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;           model%ntcw,         model%num_p2d,      model%num_p3d, model%npdf3d,   &amp;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;           model%ntoz,         model%iovr_sw,      model%iovr_lw, model%isubc_sw, &amp;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;           model%isubc_lw,     model%crick_proof,  model%ccnorm,                  &amp;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;           model%imp_physics,  model%norad_precip, model%idate,   model%iflip,  model%me)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">deallocate</span> (si)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">!   microphysics initialization calls</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">!   --------------------------------- </span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">if</span> (model%imp_physics == 10) <span class="keywordflow">then</span>          <span class="comment">!--- initialize Morrison-Gettleman microphysics</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">if</span> (model%fprcp &lt;= 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keyword">call </span>ini_micro (model%mg_dcs, model%mg_qcvar, model%mg_ts_auto_ice)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keyword">call </span>micro_mg_init( kind_phys, gravit, rair, rh2o, cpair,          &amp;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                            tmelt, latvap, latice, 1.01_kind_phys,         &amp;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                            model%mg_dcs,model%mg_ts_auto_ice,             &amp;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                            model%mg_qcvar,                                &amp;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                            model%microp_uniform, model%do_cldice,         &amp;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                            model%hetfrz_classnuc,                         &amp;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">!                          .false., .true., .false.,                       &amp;</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">!                          &#39;in_cloud        &#39;, 2._kind_phys,               &amp;</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">!                          .true., .true., .false.,                        &amp;</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                           <span class="stringliteral">&#39;max_overlap     &#39;</span>, 2._kind_phys,               &amp;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                           .true., .true.,                                 &amp;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                           .false., .false., 100.e6_kind_phys, 0.15e6_kind_phys )</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keyword">call </span>aer_cloud_init ()</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">elseif</span> (model%imp_physics == 8) <span class="keywordflow">then</span>       <span class="comment">!--- initialize Thompson Cloud microphysics</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">if</span>(model%do_shoc) <span class="keywordflow">then</span> </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        print *,<span class="stringliteral">&#39;SHOC is not currently compatible with Thompson MP -- shutting down&#39;</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        stop </div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keywordflow">      endif</span> </div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keyword">call </span>thompson_init()                     <span class="comment">!--- add aerosol version later </span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">if</span>(model%ltaerosol) <span class="keywordflow">then</span> </div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        print *,<span class="stringliteral">&#39;Aerosol awareness is not included in this version of Thompson MP -- shutting down&#39;</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        stop </div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordflow">      endif</span> </div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">elseif</span>(model%imp_physics == 6) <span class="keywordflow">then</span>        <span class="comment">!--- initialize WSM6 Cloud microphysics</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span>(model%do_shoc) <span class="keywordflow">then</span> </div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        print *,<span class="stringliteral">&#39;SHOC is not currently compatible with WSM6 -- shutting down&#39;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        stop </div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keywordflow">      endif</span> </div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keyword">call  </span>wsm6init()</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">!      </span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(model%imp_physics == 11) <span class="keywordflow">then</span>      <span class="comment">!--- initialize GFDL Cloud microphysics</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordflow">if</span>(model%do_shoc) <span class="keywordflow">then</span> </div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         print *,<span class="stringliteral">&#39;SHOC is not currently compatible with GFDL MP -- shutting down&#39;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;         stop </div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keywordflow">      endif</span> </div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;       <span class="keyword">call </span>gfdl_cloud_microphys_init (model%me, model%master, model%nlunit, model%input_nml_file, &amp;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                                       init_parm%logunit, model%fn_nml)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keywordflow">    endif</span> </div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">!--- initialize ras</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">if</span> (model%ras) <span class="keyword">call </span>ras_init (model%levs, model%me)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">!--- initialize soil vegetation</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keyword">call </span>set_soilveg(model%me, model%isot, model%ivegsrc, model%nlunit)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">!--- lsidea initialization</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (model%lsidea) <span class="keywordflow">then</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      print *,<span class="stringliteral">&#39; LSIDEA is active but needs to be reworked for FV3 - shutting down&#39;</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      stop</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="comment">!--- NEED TO get the logic from the old phys/gloopb.f initialization area</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">!--- sncovr may not exist in ICs from chgres.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">!--- FV3GFS handles this as part of the IC ingest</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">!--- this note is placed here alertng users to study</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">!--- the FV3GFS_io.F90 module</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="namespacegfs__driver.html#aa53fa4a0921c4443630976402933ff44">gfs_initialize</a></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">!-------------------------------------------------------------------------</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">! time_vary_step</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">!-------------------------------------------------------------------------</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">!    routine called prior to radiation and physics steps to handle:</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">!      1) sets up various time/date variables</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">!      2) sets up various triggers</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">!      3) defines random seed indices for radiation (in a reproducible way)</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">!      5) interpolates coefficients for prognostic ozone calculation</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">!      6) performs surface data cycling via the GFS gcycle routine</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">!-------------------------------------------------------------------------</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="namespacegfs__driver.html#ad673b930d2e2319a99586ec2232ebea0">gfs_time_vary_step</a> (Model, Statein, Stateout, Sfcprop, Coupling, &amp; </div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                 Grid, Tbd, Cldprop, Radtend, Diag)</div><div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#ad673b930d2e2319a99586ec2232ebea0">  300</a></span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">!--- interface variables</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>),   <span class="keywordtype">intent(inout)</span> :: Model</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_statein_type</a>),   <span class="keywordtype">intent(inout)</span> :: Statein(:)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_stateout_type</a>),  <span class="keywordtype">intent(inout)</span> :: Stateout(:)</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_sfcprop_type</a>),   <span class="keywordtype">intent(inout)</span> :: Sfcprop(:)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_coupling_type</a>),  <span class="keywordtype">intent(inout)</span> :: Coupling(:)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>),      <span class="keywordtype">intent(inout)</span> :: Grid(:)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>),       <span class="keywordtype">intent(inout)</span> :: Tbd(:)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_cldprop_type</a>),   <span class="keywordtype">intent(inout)</span> :: Cldprop(:)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_radtend_type</a>),   <span class="keywordtype">intent(inout)</span> :: Radtend(:)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_diag_type</a>),      <span class="keywordtype">intent(inout)</span> :: Diag(:)</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">!--- local variables</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordtype">integer</span> :: nb, nblks, k</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span> :: rinc(5)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span> :: sec</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    nblks = <span class="keyword">size</span>(<a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>)</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">!--- Model%jdat is being updated directly inside of FV3GFS_cap.F90</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">!--- update calendars and triggers</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    rinc(1:5)   = 0</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keyword">call </span>w3difdat(model%jdat,model%idat,4,rinc)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    sec = rinc(4)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    model%phour = sec/<a class="code" href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">con_hr</a></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">!--- set current bucket hour</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    model%zhour = model%phour</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    model%fhour = (sec + model%dtp)/<a class="code" href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">con_hr</a></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    model%kdt   = nint((sec + model%dtp)/model%dtp)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    model%ipt    = 1</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    model%lprnt  = .false.</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    model%lssav  = .true.</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">!--- radiation triggers</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    model%lsswr  = (mod(model%kdt, model%nsswr) == 1)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    model%lslwr  = (mod(model%kdt, model%nslwr) == 1)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">!--- set the solar hour based on a combination of phour and time initial hour</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    model%solhr  = mod(model%phour+model%idate(1),<a class="code" href="namespacegfs__driver.html#a361be517e7eafe75c98c0676d08468d3">con_24</a>)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> ((model%debug) .and. (model%me == model%master)) <span class="keywordflow">then</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      print *,<span class="stringliteral">&#39;   sec &#39;</span>, sec</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      print *,<span class="stringliteral">&#39;   kdt &#39;</span>, model%kdt</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      print *,<span class="stringliteral">&#39; nsswr &#39;</span>, model%nsswr</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      print *,<span class="stringliteral">&#39; nslwr &#39;</span>, model%nslwr</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      print *,<span class="stringliteral">&#39; nscyc &#39;</span>, model%nscyc</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      print *,<span class="stringliteral">&#39; lsswr &#39;</span>, model%lsswr</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      print *,<span class="stringliteral">&#39; lslwr &#39;</span>, model%lslwr</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      print *,<span class="stringliteral">&#39; fhour &#39;</span>, model%fhour</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      print *,<span class="stringliteral">&#39; phour &#39;</span>, model%phour</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      print *,<span class="stringliteral">&#39; solhr &#39;</span>, model%solhr</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">!--- radiation time varying routine</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (model%lsswr .or. model%lslwr) <span class="keywordflow">then</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacegfs__driver.html#a1d85ae05ce74656622bac0724c16e47b">gfs_rad_time_vary</a> (model, statein, tbd, sec)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">!--- physics time varying routine</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacegfs__driver.html#a9085d55c53755e5dd9cfae5665dc8a60">gfs_phys_time_vary</a> (model, grid, tbd)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">!--- repopulate specific time-varying sfc properties for AMIP/forecast runs</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (model%nscyc &gt;  0) <span class="keywordflow">then</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">if</span> (mod(model%kdt,model%nscyc) == 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keyword">call </span>gcycle (nblks, model, grid(:), sfcprop(:), cldprop(:))</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">!--- determine if diagnostics buckets need to be cleared</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">if</span> (mod(model%kdt,model%nszero) == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">do</span> nb = 1,nblks</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keyword">call </span>diag(nb)%rad_zero  (model)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keyword">call </span>diag(nb)%phys_zero (model)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">!!!!  THIS IS THE POINT AT WHICH DIAG%ZHOUR NEEDS TO BE UPDATED</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keyword">call </span>run_stochastic_physics(nblks,model,grid(:),coupling(:))</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">! kludge for output</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (model%do_skeb) <span class="keywordflow">then</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;       <span class="keywordflow">do</span> nb = 1,nblks</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          <span class="keywordflow">do</span> k=1,model%levs</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;             diag(nb)%skebu_wts(:,k)=coupling(nb)%skebu_wts(:,model%levs-k+1)</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;             diag(nb)%skebv_wts(:,k)=coupling(nb)%skebv_wts(:,model%levs-k+1)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">!if (Model%do_sppt) then</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">!   do nb = 1,nblks</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">!      do k=1,Model%levs</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">!         Diag(nb)%sppt_wts(:,k)=Coupling(nb)%sppt_wts(:,Model%levs-k+1)</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">!      enddo</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">!   enddo</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">!endif</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> (model%do_shum) <span class="keywordflow">then</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;       <span class="keywordflow">do</span> nb = 1,nblks</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          <span class="keywordflow">do</span> k=1,model%levs</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;             diag(nb)%shum_wts(:,k)=coupling(nb)%shum_wts(:,model%levs-k+1)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="namespacegfs__driver.html#ad673b930d2e2319a99586ec2232ebea0">gfs_time_vary_step</a></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">!-------------------------------------------------------------------------</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">! GFS stochastic_driver</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">!-------------------------------------------------------------------------</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">!    routine called prior to radiation and physics steps to handle:</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">!      1) sets up various time/date variables</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">!      2) sets up various triggers</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">!      3) defines random seed indices for radiation (in a reproducible way)</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">!      5) interpolates coefficients for prognostic ozone calculation</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">!      6) performs surface data cycling via the GFS gcycle routine</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">!-------------------------------------------------------------------------</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="namespacegfs__driver.html#a913f6dc554990798c132f51cf053b2fb">gfs_stochastic_driver</a> (Model, Statein, Stateout, Sfcprop, Coupling, &amp;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                                    Grid, Tbd, Cldprop, Radtend, Diag)</div><div class="line"><a name="l00418"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#a913f6dc554990798c132f51cf053b2fb">  418</a></span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">!--- interface variables</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>),   <span class="keywordtype">intent(in   )</span> :: Model</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_statein_type</a>),   <span class="keywordtype">intent(in   )</span> :: Statein</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_stateout_type</a>),  <span class="keywordtype">intent(in   )</span> :: Stateout</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_sfcprop_type</a>),   <span class="keywordtype">intent(in   )</span> :: Sfcprop</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_coupling_type</a>),  <span class="keywordtype">intent(inout)</span> :: Coupling</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>),      <span class="keywordtype">intent(in   )</span> :: Grid</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>),       <span class="keywordtype">intent(in   )</span> :: Tbd</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_cldprop_type</a>),   <span class="keywordtype">intent(in   )</span> :: Cldprop</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_radtend_type</a>),   <span class="keywordtype">intent(in   )</span> :: Radtend</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_diag_type</a>),      <span class="keywordtype">intent(inout)</span> :: Diag</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">!--- local variables</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordtype">integer</span> :: k, i</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span> :: upert, vpert, tpert, qpert, qnew,sppt_vwt</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;     <span class="keywordflow">if</span> (model%do_sppt) <span class="keywordflow">then</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;       <span class="keywordflow">do</span> k = 1,<span class="keyword">size</span>(statein%tgrs,2)</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;         <span class="keywordflow">do</span> i = 1,<span class="keyword">size</span>(statein%tgrs,1)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;           sppt_vwt=1.0</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;           <span class="keywordflow">if</span> (diag%zmtnblck(i).EQ.0.0) <span class="keywordflow">then</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;              sppt_vwt=1.0</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;           <span class="keywordflow">else</span> </div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;              <span class="keywordflow">if</span> (k.GT.diag%zmtnblck(i)+2) <span class="keywordflow">then</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                 sppt_vwt=1.0</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;              <span class="keywordflow">if</span> (k.LE.diag%zmtnblck(i)) <span class="keywordflow">then</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                 sppt_vwt=0.0</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;              <span class="keywordflow">if</span> (k.EQ.diag%zmtnblck(i)+1) <span class="keywordflow">then</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                 sppt_vwt=0.333333</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;              <span class="keywordflow">if</span> (k.EQ.diag%zmtnblck(i)+2) <span class="keywordflow">then</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                 sppt_vwt=0.666667</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="keywordflow">              endif</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;           <span class="keywordflow">if</span> (model%use_zmtnblck)<span class="keywordflow">then</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;              coupling%sppt_wts(i,k)=(coupling%sppt_wts(i,k)-1)*sppt_vwt+1.0</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;           diag%sppt_wts(i,model%levs-k+1)=coupling%sppt_wts(i,k)</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      </div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;           upert = (stateout%gu0(i,k)   - statein%ugrs(i,k))   * coupling%sppt_wts(i,k)</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;           vpert = (stateout%gv0(i,k)   - statein%vgrs(i,k))   * coupling%sppt_wts(i,k)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;           tpert = (stateout%gt0(i,k)   - statein%tgrs(i,k) - tbd%dtdtr(i,k)) * coupling%sppt_wts(i,k)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;           qpert = (stateout%gq0(i,k,1) - statein%qgrs(i,k,1)) * coupling%sppt_wts(i,k)</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;           stateout%gu0(i,k)  = statein%ugrs(i,k)+upert</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;           stateout%gv0(i,k)  = statein%vgrs(i,k)+vpert</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;           <span class="comment">!negative humidity check</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;           qnew = statein%qgrs(i,k,1)+qpert</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;           <span class="keywordflow">if</span> (qnew &gt;= 1.0e-10) <span class="keywordflow">then</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;              stateout%gq0(i,k,1) = qnew</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;              stateout%gt0(i,k)   = statein%tgrs(i,k) + tpert + tbd%dtdtr(i,k)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keywordflow">           endif</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordflow">         enddo</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;       <span class="comment">! instantaneous precip rate going into land model at the next time step</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;       sfcprop%tprcp(:) = coupling%sppt_wts(:,15)*sfcprop%tprcp(:)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;       diag%totprcp(:)      = diag%totprcp(:)      + (coupling%sppt_wts(:,15) - 1 )*diag%rain(:)</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;       <span class="comment">! acccumulated total and convective preciptiation</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;       diag%cnvprcp(:)      = diag%cnvprcp(:)      + (coupling%sppt_wts(:,15) - 1 )*diag%rainc(:)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">if</span> (model%cplflx) <span class="keywordflow">then</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;           coupling%rain_cpl(:) = coupling%rain_cpl(:) + (coupling%sppt_wts(:,15) - 1.0)*tbd%drain_cpl(:)</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;           coupling%snow_cpl(:) = coupling%snow_cpl(:) + (coupling%sppt_wts(:,15) - 1.0)*tbd%dsnow_cpl(:)</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;     <span class="keywordflow">if</span> (model%do_shum) <span class="keywordflow">then</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;       stateout%gq0(:,:,1) = stateout%gq0(:,:,1)*(1.0 + coupling%shum_wts(:,:))</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;     <span class="keywordflow">if</span> (model%do_skeb) <span class="keywordflow">then</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;       <span class="keywordflow">do</span> k = 1,<span class="keyword">size</span>(statein%tgrs,2)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;           stateout%gu0(:,k) = stateout%gu0(:,k)+coupling%skebu_wts(:,k)*(statein%diss_est(:,k))</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;           stateout%gv0(:,k) = stateout%gv0(:,k)+coupling%skebv_wts(:,k)*(statein%diss_est(:,k))</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;       <span class="comment">!    print*,&#39;in do skeb&#39;,Coupling%skebu_wts(1,k),Statein%diss_est(1,k)</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="namespacegfs__driver.html#a913f6dc554990798c132f51cf053b2fb">gfs_stochastic_driver</a></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">!                     PRIVATE SUBROUTINES</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">! GFS_rad_time_vary</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">!  Routine containing all of the setup logic originally in phys/gloopr.f</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="namespacegfs__driver.html#a1d85ae05ce74656622bac0724c16e47b">gfs_rad_time_vary</a> (Model, Statein, Tbd, sec)</div><div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#a1d85ae05ce74656622bac0724c16e47b">  518</a></span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordtype">use </span>physparam<span class="keywordtype">,        only</span>: ipsd0, ipsdlim, iaerflg</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordtype">use </span>mersenne_twister<span class="keywordtype">, only</span>: random_setseed, random_index, random_stat</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>),   <span class="keywordtype">intent(inout)</span> :: Model</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_statein_type</a>),   <span class="keywordtype">intent(in)</span>    :: Statein(:)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>),       <span class="keywordtype">intent(inout)</span> :: Tbd(:)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span>,     <span class="keywordtype">intent(in)</span>    :: sec</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">!--- local variables</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    type(random_stat) :: stat</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordtype">integer</span> :: ix, nb, j, i, nblks, ipseed</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordtype">integer</span> :: numrdm(model%cnx*model%cny*2)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    nblks = <span class="keyword">size</span>(<a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>,1)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">call </span><a class="code" href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">radupdate</a> (model%idat, model%jdat, model%fhswr, model%dtf,  model%lsswr, &amp;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                    model%me,   model%slag, model%sdec,  model%cdec, model%solcon)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">!--- set up random seed index in a reproducible way for entire cubed-sphere face (lat-lon grid)</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">if</span> ((model%isubc_lw==2) .or. (model%isubc_sw==2)) <span class="keywordflow">then</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      ipseed = mod(nint(<a class="code" href="namespacegfs__driver.html#ac7e929b29814a67e0c2d8f59b7a8f7ef">con_100</a>*sqrt(sec)), ipsdlim) + 1 + ipsd0</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keyword">call </span>random_setseed (ipseed, stat)</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keyword">call </span>random_index (ipsdlim, numrdm, stat)</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="comment">!--- set the random seeds for each column in a reproducible way</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      ix = 0</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      nb = 1</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">do</span> j = 1,model%ny</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">do</span> i = 1,model%nx</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          ix = ix + 1</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;          <span class="keywordflow">if</span> (ix &gt; <a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>(nb)) <span class="keywordflow">then</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            ix = 1</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            nb = nb + 1</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;          <span class="comment">!--- for testing purposes, replace numrdm with &#39;100&#39;</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;          tbd(nb)%icsdsw(ix) = numrdm(i+model%isc-1 + (j+model%jsc-2)*model%cnx)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;          tbd(nb)%icsdlw(ix) = numrdm(i+model%isc-1 + (j+model%jsc-2)*model%cnx + model%cnx*model%cny)</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordflow">    endif</span>  <span class="comment">! isubc_lw and isubc_sw</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span> (model%imp_physics == 99) <span class="keywordflow">then</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">if</span> (model%kdt == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">do</span> nb = 1,nblks</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          tbd(nb)%phy_f3d(:,:,1) = statein(nb)%tgrs</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          tbd(nb)%phy_f3d(:,:,2) = max(<a class="code" href="namespacegfs__driver.html#a1dc506e00472176743d287ee18bb19c1">qmin</a>,statein(nb)%qgrs(:,:,1))</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          tbd(nb)%phy_f3d(:,:,3) = statein(nb)%tgrs</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          tbd(nb)%phy_f3d(:,:,4) = max(<a class="code" href="namespacegfs__driver.html#a1dc506e00472176743d287ee18bb19c1">qmin</a>,statein(nb)%qgrs(:,:,1))</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          tbd(nb)%phy_f2d(:,1)   = statein(nb)%prsi(:,1)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;          tbd(nb)%phy_f2d(:,2)   = statein(nb)%prsi(:,1)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="namespacegfs__driver.html#a1d85ae05ce74656622bac0724c16e47b">gfs_rad_time_vary</a></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">! GFS_phys_time_vary</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">!  Routine containing all of the setup logic originally in phys/gloopb.f</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">!-----------------------------------------------------------------------</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="namespacegfs__driver.html#a9085d55c53755e5dd9cfae5665dc8a60">gfs_phys_time_vary</a> (Model, Grid, Tbd)</div><div class="line"><a name="l00585"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#a9085d55c53755e5dd9cfae5665dc8a60">  585</a></span>&#160;    <span class="keywordtype">use </span>mersenne_twister<span class="keywordtype">, only</span>: random_setseed, random_number</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>),   <span class="keywordtype">intent(inout)</span> :: Model</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>),      <span class="keywordtype">intent(inout)</span> :: Grid(:)</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>),       <span class="keywordtype">intent(inout)</span> :: Tbd(:)</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">!--- local variables</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordtype">integer</span> :: nb, ix, k, j, i, nblks, iseed, iskip</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span> :: wrk(1)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span> :: rannie(model%cny)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span> :: rndval(model%cnx*model%cny*model%nrcm)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    nblks = <span class="keyword">size</span>(<a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>,1)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">!--- switch for saving convective clouds - cnvc90.f </span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">!--- aka Ken Campana/Yu-Tai Hou legacy</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">if</span> ((mod(model%kdt,model%nsswr) == 0) .and. (model%lsswr)) <span class="keywordflow">then</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="comment">!--- initialize,accumulate,convert</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      model%clstp = 1100 + min(model%fhswr/<a class="code" href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">con_hr</a>,model%fhour,<a class="code" href="namespacegfs__driver.html#a741fe74ab1500b05fa747a711e74610e">con_99</a>)</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">elseif</span> (mod(model%kdt,model%nsswr) == 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="comment">!--- accumulate,convert</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      model%clstp = 0100 + min(model%fhswr/<a class="code" href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">con_hr</a>,model%fhour,<a class="code" href="namespacegfs__driver.html#a741fe74ab1500b05fa747a711e74610e">con_99</a>)</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">elseif</span> (model%lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="comment">!--- initialize,accumulate</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      model%clstp = 1100</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="comment">!--- accumulate</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      model%clstp = 0100</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">!--- random number needed for RAS and old SAS and when cal_pre=.true.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">if</span> ( ((model%imfdeepcnv &lt;= 0) .or. (model%cal_pre)) .and. (model%random_clds) ) <span class="keywordflow">then</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      iseed = mod(<a class="code" href="namespacegfs__driver.html#ac7e929b29814a67e0c2d8f59b7a8f7ef">con_100</a>*sqrt(model%fhour*<a class="code" href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">con_hr</a>),1.0d9) + model%seed0</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keyword">call </span>random_setseed(iseed)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keyword">call </span>random_number(wrk)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordflow">do</span> i = 1,model%cnx*model%nrcm</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        iseed = iseed + nint(wrk(1)) * i</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keyword">call </span>random_setseed(iseed)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="keyword">call </span>random_number(rannie)</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        rndval(1+(i-1)*model%cny:i*model%cny) = rannie(1:model%cny)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">do</span> k = 1,model%nrcm</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        iskip = (k-1)*model%cnx*model%cny</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        ix = 0</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        nb = 1</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordflow">do</span> j = 1,model%ny</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          <span class="keywordflow">do</span> i = 1,model%nx</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            ix = ix + 1</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">if</span> (ix &gt; <a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>(nb)) <span class="keywordflow">then</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;              ix = 1</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;              nb = nb + 1</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            tbd(nb)%rann(ix,k) = rndval(i+model%isc-1 + (j+model%jsc-2)*model%cnx + iskip)</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keywordflow">    endif</span>  <span class="comment">! imfdeepcnv, cal_re, random_clds</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">!--- o3 interpolation</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordflow">if</span> (model%ntoz &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordflow">do</span> nb = 1, nblks</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keyword">call </span>ozinterpol (model%me, <a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>(nb), model%idate, model%fhour,     &amp;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                         grid(nb)%jindx1_o3, grid(nb)%jindx2_o3,            &amp;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                         tbd(nb)%ozpl, grid(nb)%ddy_o3)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keywordflow">    endif</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">!--- h2o interpolation</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;     <span class="keywordflow">if</span> (model%h2o_phys) <span class="keywordflow">then</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;       <span class="keywordflow">do</span> nb = 1, nblks</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         <span class="keyword">call </span>h2ointerpol (model%me, <a class="code" href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">blksz</a>(nb), model%idate, model%fhour, &amp;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                           grid(nb)%jindx1_h, grid(nb)%jindx2_h,          &amp;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                           tbd(nb)%h2opl, grid(nb)%ddy_h)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="keywordflow">       enddo</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="keywordflow">     endif</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="namespacegfs__driver.html#a9085d55c53755e5dd9cfae5665dc8a60">gfs_phys_time_vary</a></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">!------------------</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">! GFS_grid_populate</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">!------------------</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="namespacegfs__driver.html#a59f5e1e0612794f6801490d8d642b89b">gfs_grid_populate</a> (Grid, xlon, xlat, area)</div><div class="line"><a name="l00669"></a><span class="lineno"><a class="line" href="namespacegfs__driver.html#a59f5e1e0612794f6801490d8d642b89b">  669</a></span>&#160;    <span class="keywordtype">use </span>physcons<span class="keywordtype">,                 only</span>: pi =&gt; con_pi</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>)              :: Grid(:)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: xlon(:,:)</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: xlat(:,:)</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: area(:,:)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">!--- local variables</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordtype">integer</span> :: nb, ix, blksz, i, j</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    blksz = <span class="keyword">size</span>(grid(1)%xlon)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    nb = 1</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    ix = 0</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">do</span> j = 1,<span class="keyword">size</span>(xlon,2)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">do</span> i = 1,<span class="keyword">size</span>(xlon,1)</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        ix=ix+1</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">if</span> (ix &gt; blksz) <span class="keywordflow">then</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;          nb = nb + 1</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;          ix = 1</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        grid(nb)%xlon(ix)   = xlon(i,j)</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        grid(nb)%xlat(ix)   = xlat(i,j)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        grid(nb)%xlat_d(ix) = xlat(i,j) * 180.0_kind_phys/pi</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        grid(nb)%sinlat(ix) = sin(grid(nb)%xlat(ix))</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        grid(nb)%coslat(ix) = sqrt(1.0_kind_phys - grid(nb)%sinlat(ix)*grid(nb)%sinlat(ix))</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        grid(nb)%area(ix)   = area(i,j)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        grid(nb)%dx(ix)     = sqrt(area(i,j))</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="keywordflow">    enddo</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="namespacegfs__driver.html#a59f5e1e0612794f6801490d8d642b89b">gfs_grid_populate</a></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keyword">end module </span><a class="code" href="namespacegfs__driver.html">gfs_driver</a></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="ttc" id="namespacegfs__driver_html_ad673b930d2e2319a99586ec2232ebea0"><div class="ttname"><a href="namespacegfs__driver.html#ad673b930d2e2319a99586ec2232ebea0">gfs_driver::gfs_time_vary_step</a></div><div class="ttdeci">subroutine, public gfs_time_vary_step(Model, Statein, Stateout, Sfcprop, Coupling, Grid, Tbd, Cldprop, Radtend, Diag)</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00300">GFS_driver.F90:300</a></div></div>
<div class="ttc" id="namespacegfs__driver_html"><div class="ttname"><a href="namespacegfs__driver.html">gfs_driver</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00001">GFS_driver.F90:1</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_a9085d55c53755e5dd9cfae5665dc8a60"><div class="ttname"><a href="namespacegfs__driver.html#a9085d55c53755e5dd9cfae5665dc8a60">gfs_driver::gfs_phys_time_vary</a></div><div class="ttdeci">subroutine gfs_phys_time_vary(Model, Grid, Tbd)</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00585">GFS_driver.F90:585</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_a1d85ae05ce74656622bac0724c16e47b"><div class="ttname"><a href="namespacegfs__driver.html#a1d85ae05ce74656622bac0724c16e47b">gfs_driver::gfs_rad_time_vary</a></div><div class="ttdeci">subroutine gfs_rad_time_vary(Model, Statein, Tbd, sec)</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00518">GFS_driver.F90:518</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga9c5872d3bd177315e79977d40245a99a"><div class="ttname"><a href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a">module_radiation_driver::gfs_radiation_driver</a></div><div class="ttdeci">subroutine, public gfs_radiation_driver(Model, Statein, Stateout, Sfcprop, Coupling, Grid, Tbd, Cldprop, Radtend, Diag)</div><div class="ttdoc">This subroutine is the driver of main radiation calculations. It sets up column profiles, such as pressure, temperature, moisture, gases, clouds, aerosols, etc., as well as surface radiative characteristics, such as surface albedo, and emissivity. The call of this subroutine is placed inside both the time advancing loop and the horizontal grid loop. </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l01015">GFS_radiation_driver.F90:1015</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_ac7e929b29814a67e0c2d8f59b7a8f7ef"><div class="ttname"><a href="namespacegfs__driver.html#ac7e929b29814a67e0c2d8f59b7a8f7ef">gfs_driver::con_100</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_100</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00083">GFS_driver.F90:83</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_aa73c08b478e9f3b45e36e4a5877dfa96"><div class="ttname"><a href="namespacegfs__driver.html#aa73c08b478e9f3b45e36e4a5877dfa96">gfs_driver::con_hr</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_hr</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00081">GFS_driver.F90:81</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__sfcprop__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_typedefs::gfs_sfcprop_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00140">GFS_typedefs.F90:140</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_aa53fa4a0921c4443630976402933ff44"><div class="ttname"><a href="namespacegfs__driver.html#aa53fa4a0921c4443630976402933ff44">gfs_driver::gfs_initialize</a></div><div class="ttdeci">subroutine, public gfs_initialize(Model, Statein, Stateout, Sfcprop, Coupling, Grid, Tbd, Cldprop, Radtend, Diag, Init_parm)</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00108">GFS_driver.F90:108</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_a59f5e1e0612794f6801490d8d642b89b"><div class="ttname"><a href="namespacegfs__driver.html#a59f5e1e0612794f6801490d8d642b89b">gfs_driver::gfs_grid_populate</a></div><div class="ttdeci">subroutine gfs_grid_populate(Grid, xlon, xlat, area)</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00669">GFS_driver.F90:669</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__diag__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_typedefs::gfs_diag_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00772">GFS_typedefs.F90:772</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_a913f6dc554990798c132f51cf053b2fb"><div class="ttname"><a href="namespacegfs__driver.html#a913f6dc554990798c132f51cf053b2fb">gfs_driver::gfs_stochastic_driver</a></div><div class="ttdeci">subroutine, public gfs_stochastic_driver(Model, Statein, Stateout, Sfcprop, Coupling, Grid, Tbd, Cldprop, Radtend, Diag)</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00418">GFS_driver.F90:418</a></div></div>
<div class="ttc" id="namespacemodule__physics__driver_html"><div class="ttname"><a href="namespacemodule__physics__driver.html">module_physics_driver</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__physics__driver_8_f90_source.html#l00001">GFS_physics_driver.F90:1</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__radtend__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_typedefs::gfs_radtend_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00729">GFS_typedefs.F90:729</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__coupling__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_typedefs::gfs_coupling_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00222">GFS_typedefs.F90:222</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__init__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__init__type.html">gfs_typedefs::gfs_init_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00049">GFS_typedefs.F90:49</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__control__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__control__type.html">gfs_typedefs::gfs_control_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00324">GFS_typedefs.F90:324</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__cldprop__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_typedefs::gfs_cldprop_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00712">GFS_typedefs.F90:712</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_a1dc506e00472176743d287ee18bb19c1"><div class="ttname"><a href="namespacegfs__driver.html#a1dc506e00472176743d287ee18bb19c1">gfs_driver::qmin</a></div><div class="ttdeci">real(kind=kind_phys), parameter qmin</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00084">GFS_driver.F90:84</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__statein__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_typedefs::gfs_statein_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00092">GFS_typedefs.F90:92</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_aa3cc44000d84c245dd953c17da5c0f4b"><div class="ttname"><a href="namespacegfs__driver.html#aa3cc44000d84c245dd953c17da5c0f4b">gfs_driver::blksz</a></div><div class="ttdeci">integer, dimension(:), allocatable blksz</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00086">GFS_driver.F90:86</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_a741fe74ab1500b05fa747a711e74610e"><div class="ttname"><a href="namespacegfs__driver.html#a741fe74ab1500b05fa747a711e74610e">gfs_driver::con_99</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_99</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00082">GFS_driver.F90:82</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__grid__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_typedefs::gfs_grid_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00640">GFS_typedefs.F90:640</a></div></div>
<div class="ttc" id="namespacegfs__driver_html_a361be517e7eafe75c98c0676d08468d3"><div class="ttname"><a href="namespacegfs__driver.html#a361be517e7eafe75c98c0676d08468d3">gfs_driver::con_24</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_24</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__driver_8_f90_source.html#l00080">GFS_driver.F90:80</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__stateout__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_typedefs::gfs_stateout_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00123">GFS_typedefs.F90:123</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__tbd__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_typedefs::gfs_tbd_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00671">GFS_typedefs.F90:671</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga28280ee9ea8ee0d183ab9d541a31b718"><div class="ttname"><a href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">module_radiation_driver::radupdate</a></div><div class="ttdeci">subroutine, public radupdate(idate, jdate, deltsw, deltim, lsswr, me, slag, sdec, cdec, solcon)</div><div class="ttdoc">This subroutine checks and updates time sensitive data used by radiation computations. This subroutine needs to be placed inside the time advancement loop but outside of the horizontal grid loop. It is invoked at radiation calling frequncy but before any actual radiative transfer computations. </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00667">GFS_radiation_driver.F90:667</a></div></div>
<div class="ttc" id="namespacegfs__typedefs_html"><div class="ttname"><a href="namespacegfs__typedefs.html">gfs_typedefs</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00001">GFS_typedefs.F90:1</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html"><div class="ttname"><a href="namespacemodule__radiation__driver.html">module_radiation_driver</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00306">GFS_radiation_driver.F90:306</a></div></div>
<div class="ttc" id="namespacemodule__physics__driver_html_a13c7ad66034ebcbe6f77208d83ac54da"><div class="ttname"><a href="namespacemodule__physics__driver.html#a13c7ad66034ebcbe6f77208d83ac54da">module_physics_driver::gfs_physics_driver</a></div><div class="ttdeci">subroutine, public gfs_physics_driver(Model, Statein, Stateout, Sfcprop, Coupling, Grid, Tbd, Cldprop, Radtend, Diag)</div><div class="ttdoc">GFS Physics Implementation Layer. </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__physics__driver_8_f90_source.html#l00402">GFS_physics_driver.F90:402</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2961c5a6060afe1eafbb56d6f69a970f.html">GFS_layer</a></li><li class="navelem"><a class="el" href="_g_f_s__driver_8_f90.html">GFS_driver.F90</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
