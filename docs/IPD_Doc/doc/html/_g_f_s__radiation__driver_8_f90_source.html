<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Interoperable Physics Driver for NGGPS: GFS_radiation_driver.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ncep.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Interoperable Physics Driver for NGGPS
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_g_f_s__radiation__driver_8_f90_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">GFS_radiation_driver.F90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_g_f_s__radiation__driver_8_f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">! ==========================================================  !!!!!</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">!             &#39;module_radiation_driver&#39; descriptions           !!!!!</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">!  ==========================================================  !!!!!</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">!   this is the radiation driver module.  it prepares atmospheric      !</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!   profiles and invokes main radiation calculations.                  !</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!   in module &#39;module_radiation_driver&#39; there are twe externally       !</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!   callable subroutine:                                               !</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">!      &#39;radinit&#39;    -- initialization routine                          !</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">!         input:                                                       !</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">!           ( si, NLAY, me )                                           !</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">!         output:                                                      !</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">!           ( none )                                                   !</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">!      &#39;radupdate&#39;  -- update time sensitive data used by radiations   !</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">!         input:                                                       !</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">!           ( idate,jdate,deltsw,deltim,lsswr, me )                    !</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">!         output:                                                      !</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">!           ( slag,sdec,cdec,solcon )                                  !</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">!      &#39;grrad&#39;      -- setup and invoke main radiation calls           !</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">!         input:                                                       !</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">!          ( prsi,prsl,prslk,tgrs,qgrs,tracer,vvl,slmsk,               !</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">!            xlon,xlat,tsfc,snowd,sncovr,snoalb,zorl,hprim,            !</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">!            alvsf,alnsf,alvwf,alnwf,facsf,facwf,fice,tisfc,           !</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">!            sinlat,coslat,solhr,jdate,solcon,                         !</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">!            cv,cvt,cvb,fcice,frain,rrime,flgmin,                      !</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">!            icsdsw,icsdlw, ntcw,ncld,ntoz, NTRAC,NFXR,                !</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">!            dtlw,dtsw, lsswr,lslwr,lssav,                             !</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">!            IX, IM, LM, me, lprnt, ipt, kdt,deltaq,sup,cnvw,cnvc,     !</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">!         output:                                                      !</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">!            htrsw,topfsw,sfcfsw,dswcmp,uswcmp,sfalb,coszen,coszdg,    !</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">!            htrlw,topflw,sfcflw,tsflw,semis,cldcov,                   !</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">!         input/output:                                                !</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">!            fluxr                                                     !</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">!         optional output:                                             !</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">!            htrlw0,htrsw0,htrswb,htrlwb                               !</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">!   external modules referenced:                                       !</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">!       &#39;module physparam&#39;                  in &#39;physparam.f&#39;           !</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">!       &#39;module funcphys&#39;                   in &#39;funcphys.f&#39;            !</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">!       &#39;module physcons&#39;                   in &#39;physcons.f&#39;            !</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">!       &#39;module module_radiation_gases&#39;     in &#39;radiation_gases.f&#39;     !</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">!       &#39;module module_radiation_aerosols&#39;  in &#39;radiation_aerosols.f&#39;  !</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">!       &#39;module module_radiation_surface&#39;   in &#39;radiation_surface.f&#39;   !</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">!       &#39;module module_radiation_clouds&#39;    in &#39;radiation_clouds.f&#39;    !</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">!       &#39;module module_radsw_cntr_para&#39;     in &#39;radsw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">!       &#39;module module_radsw_parameters&#39;    in &#39;radsw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">!       &#39;module module_radsw_main&#39;          in &#39;radsw_xxxx_main.f&#39;     !</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">!       &#39;module module_radlw_cntr_para&#39;     in &#39;radlw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">!       &#39;module module_radlw_parameters&#39;    in &#39;radlw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">!       &#39;module module_radlw_main&#39;          in &#39;radlw_xxxx_main.f&#39;     !</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">!    where xxxx may vary according to different scheme selection       !</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">!   program history log:                                               !</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">!     mm-dd-yy    ncep         - created program grrad                 !</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">!     08-12-03    yu-tai hou   - re-written for modulized radiations   !</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">!     11-06-03    yu-tai hou   - modified                              !</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">!     01-18-05    s. moorthi   - NOAH/ICE model changes added          !</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">!     05-10-05    yu-tai hou   - modified module structure             !</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">!     12-xx-05    s. moorthi   - sfc lw flux adj by mean temperature   !</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">!     02-20-06    yu-tai hou   - add time variation for co2 data, and  !</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">!                                solar const. add sfc emiss change     !</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">!     03-21-06    s. Moorthi   - added surface temp over ice           !</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">!     07-28-06    yu-tai hou   - add stratospheric vocanic aerosols    !</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">!     03-14-07    yu-tai hou   - add generalized spectral band interp  !</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!                                for aerosol optical prop. (sw and lw) !</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">!     04-10-07    yu-tai hou   - spectral band sw/lw heating rates     !</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">!     05-04-07    yu-tai hou   - make options for clim based and modis !</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">!                                based (h. wei and c. marshall) albedo !</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">!     09-05-08    yu-tai hou   - add the initial date and time &#39;idate&#39; !</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">!                    and control param &#39;ICTM&#39; to the passing param list!</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">!                    to handel different time/date requirements for    !</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">!                    external data (co2, aeros, solcon, ...)           !</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">!     10-10-08    yu-tai hou   - add the ICTM=-2 option for combining  !</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">!                    initial condition data with seasonal cycle from   !</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">!                    climatology.                                      !</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">!     03-12-09    yu-tai hou   - use two time stamps to keep tracking  !</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">!                    dates for init cond and fcst time. remove volcanic!</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">!                    aerosols data in climate hindcast (ICTM=-2).      !</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">!     03-16-09    yu-tai hou   - included sub-column clouds approx.    !</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">!                    control flags isubcsw/isubclw in initialization   !</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">!                    subroutine. passed auxiliary cloud control arrays !</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">!                    icsdsw/icsdlw (if isubcsw/isubclw =2, it will be  !</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">!                    the user provided permutation seeds) to the sw/lw !</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">!                    radiation calculation programs. also moved cloud  !</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">!                    overlapping control flags iovrsw/iovrlw from main !</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">!                    radiation routines to the initialization routines.!</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">!     04-02-09    yu-tai hou   - modified surface control flag iems to !</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">!                    have additional function of if the surface-air    !</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">!                    interface have the same or different temperature  !</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">!                    for radiation calculations.                       !</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">!     04-03-09    yu-tai hou   - modified to add lw surface emissivity !</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">!                    as output variable. changed the sign of sfcnsw to !</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">!                    be positive value denote solar flux goes into the !</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">!                    ground (this is needed to reduce sign confusion   !</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">!                    in other part of model)                           !</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">!     09-09-09    fanglin yang (thru s.moorthi) added QME5 QME6 to E-20!</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">!     01-09-10    sarah lu     - added gocart option, revised grrad for!</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">!                    gocart coupling. calling argument modifed: ldiag3 !</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">!                    removed; cldcov/fluxr sequence changed; cldcov is !</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">!                    changed from accumulative to instant field and    !</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">!                    from input/output to output field                 !</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">!     01-24-10    sarah lu     - added aod to fluxr, added prslk and   !</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">!                    oz to setaer input argument (for gocart coupling),!</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">!                    added tau_gocart to setaer output argument (for,  !</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">!                    aerosol diag by index of nv_aod)                  !</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">!     07-08-10    s.moorthi - updated the NEMS version for new physics !</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">!     07-28-10    yu-tai hou   - changed grrad interface to allow all  !</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">!                    components of sw/lw toa/sfc instantaneous values  !</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">!                    being passed to the calling program. moved the    !</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">!                    computaion of sfc net sw flux (sfcnsw) to the     !</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">!                    calling program. merged carlos&#39; nmmb modification.!</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">!     07-30-10    s. moorthi - corrected some errors associated with   !</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">!                    unit changes                                      !</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">!     12-02-10    s. moorthi/y. hou - removed the use of aerosol flags !</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">!                    &#39;iaersw&#39; &#39;iaerlw&#39; from radiations and replaced    !</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">!                    them by using the runtime variable laswflg and    !</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">!                    lalwflg defined in module radiation_aerosols.     !</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">!                    also replaced param nspc in grrad with the use of !</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">!                    max_num_gridcomp in module radiation_aerosols.    !</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">!     jun 2012    yu-tai hou   - added sea/land madk &#39;slmsk&#39; to the    !</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">!                    argument list of subrotine setaer call for the    !</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">!                    newly modified horizontal bi-linear interpolation !</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">!                    in climatological aerosols schem. also moved the  !</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">!                    virtual temperature calculations in subroutines   !</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">!                    &#39;radiation_clouds&#39; and &#39;radiation_aerosols&#39; to    !</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">!                    &#39;grrad&#39; to reduce repeat comps. renamed var oz as !</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">!                    tracer to reflect that it carries various prog    !</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">!                    tracer quantities.                                !</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">!                              - modified to add 4 compontents of sw   !</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">!                    surface downward fluxes to the output. (vis/nir;  !</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">!                    direct/diffused). re-arranged part of the fluxr   !</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">!                    variable fields and filled the unused slots for   !</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">!                    the new components.  added check print of select  !</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">!                    data (co2 value for now).                         !</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">!                              - changed the initialization subrution  !</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">!                    &#39;radinit&#39; into two parts: &#39;radinit&#39; is called at  !</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">!                    the start of model run to set up radiation related!</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">!                    fixed parameters; and &#39;radupdate&#39; is called in    !</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">!                    the time-loop to update time-varying data sets    !</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">!                    and module variables.                             !</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">!     sep 2012    h-m lin/y-t hou added option of extra top layer for  !</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">!                    models with low toa ceiling. the extra layer will !</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">!                    help ozone absorption at higher altitude.         !</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">!     nov 2012    yu-tai hou   - modified control parameters through   !</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">!                    module &#39;physparam&#39;.                                !</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">!     jan 2013    yu-tai hou   - updated subr radupdate for including  !</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">!                    options of annual/monthly solar constant table.   !</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">!     mar 2013    h-m lin/y-t hou corrected a bug in extra top layer   !</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">!                    when using ferrier microphysics.                  !</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">!     may 2013    s. mooorthi - removed fpkapx                         !</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">!     jul 2013    r. sun - added pdf cld and convective cloud water and!</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">!                          cover for radiation                         !</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">!     aug 2013    s. moorthi  - port from gfs to nems                  !</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">!     13Feb2014   sarah lu - add aerodp to fluxr                       !</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">!     Apr 2014    Xingren Wu - add sfc SW downward fluxes nir/vis and  !</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">!                    sfcalb to export for A/O/I coupling               !</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">!     jun 2014    y-t hou    - revised code to include surface up and  !</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">!                    down spectral components sw fluxes as output.     !</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">!     Mar 2017    Ruiyu s.- add effect radii and other cloud properties!</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">!                    from the advanced MPs                             !</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">!!!!!  ==========================================================  !!!!!</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">!!!!!                       end descriptions                       !!!!!</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">!!!!!  ==========================================================  !!!!!</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">!========================================!</span></div><div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html">  306</a></span>&#160;      <span class="keyword">module</span> <a class="code" href="namespacemodule__radiation__driver.html">module_radiation_driver</a>        <span class="comment">!</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordtype">use </span>physparam</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordtype">use </span>physcons<span class="keywordtype">,                  only</span>: eps   =&gt; con_eps,            &amp;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;     &amp;                                     epsm1 =&gt; con_epsm1,          &amp;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;     &amp;                                     fvirt =&gt; con_fvirt           &amp;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;     &amp;,                                    rocp  =&gt; con_rocp</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keywordtype">use </span>funcphys<span class="keywordtype">,                  only</span>: fpvs</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordtype">use </span>module_radiation_astronomy<span class="keywordtype">,only</span>: sol_init, sol_update, coszmn</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordtype">use </span>module_radiation_gases<span class="keywordtype">,    only</span>: nf_vgas, getgases, getozn,   &amp;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;     &amp;                                     gas_init, gas_update</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keywordtype">use </span>module_radiation_aerosols<span class="keywordtype">, only</span>: nf_aesw, nf_aelw, setaer,    &amp;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;     &amp;                                     aer_init, aer_update,        &amp;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;     &amp;                                     nspc1</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordtype">use </span>module_radiation_surface<span class="keywordtype">,  only</span>: nf_albd, sfc_init, setalb,   &amp;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;     &amp;                                     setemis</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordtype">use </span>module_radiation_clouds<span class="keywordtype">,   only</span>: nf_clds, cld_init,           &amp;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;     &amp;                                     progcld1, progcld2,          &amp;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;     &amp;                                     progcld3, progcld4,          &amp;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;     &amp;                                     progcld5, progcld4o,         &amp;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;     &amp;                                     progclduni, diagcld1</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordtype">use </span>module_radsw_parameters<span class="keywordtype">,   only</span>: topfsw_type, sfcfsw_type,    &amp;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;     &amp;                                     profsw_type,cmpfsw_type,nbdsw</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordtype">use </span>module_radsw_main<span class="keywordtype">,         only</span>: rswinit,  swrad</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordtype">use </span>module_radlw_parameters<span class="keywordtype">,   only</span>: topflw_type, sfcflw_type,    &amp;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;     &amp;                                     proflw_type, nbdlw</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordtype">use </span>module_radlw_main<span class="keywordtype">,         only</span>: rlwinit,  lwrad</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacegfs__typedefs.html">gfs_typedefs</a><span class="keywordtype">,              only</span>: <a class="code" href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_statein_type</a>,             &amp;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_stateout_type</a>,            &amp;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_sfcprop_type</a>,             &amp;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_coupling_type</a>,            &amp;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>,             &amp;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>,                &amp;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>,                 &amp;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_cldprop_type</a>,             &amp;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_radtend_type</a>,             &amp;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                           <a class="code" href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_diag_type</a></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordtype">implicit   none</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordtype">private</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">!  ---  version tag and last revision date</span></div><div class="line"><a name="l00353"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#a70a36595385cf1f5794f9c5859e52ab6">  353</a></span>&#160;      <span class="keywordtype">character(40)</span>, <span class="keywordtype">parameter</span> ::                                       &amp;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;     &amp;   VTAGRAD=<span class="stringliteral">&#39;NCEP-Radiation_driver    v5.2  Jan 2013 &#39;</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">!    &amp;   VTAGRAD=&#39;NCEP-Radiation_driver    v5.1  Nov 2012 &#39;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">!    &amp;   VTAGRAD=&#39;NCEP-Radiation_driver    v5.0  Aug 2012 &#39;</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#gafdc2a7e1dbfb075ac33a2388564d9428">  361</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: <a class="code" href="group__module__radiation__driver.html#gafdc2a7e1dbfb075ac33a2388564d9428">qmin</a></div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#gab671cb80142c71dab5f41f01ccdcc088">  363</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: <a class="code" href="group__module__radiation__driver.html#gab671cb80142c71dab5f41f01ccdcc088">qme5</a></div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#ga4916e37c472b2f824b6f566ff67200cd">  365</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: <a class="code" href="group__module__radiation__driver.html#ga4916e37c472b2f824b6f566ff67200cd">qme6</a></div><div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#ga0b0bf0fa8723b80d0891ec3327d187d7">  367</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: <a class="code" href="group__module__radiation__driver.html#ga0b0bf0fa8723b80d0891ec3327d187d7">epsq</a></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">!     parameter (QMIN=1.0e-10, QME5=1.0e-5,  QME6=1.0e-6,  EPSQ=1.0e-12)</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      parameter(<a class="code" href="group__module__radiation__driver.html#gafdc2a7e1dbfb075ac33a2388564d9428">qmin</a>=1.0e-10, <a class="code" href="group__module__radiation__driver.html#gab671cb80142c71dab5f41f01ccdcc088">qme5</a>=1.0e-7,  <a class="code" href="group__module__radiation__driver.html#ga4916e37c472b2f824b6f566ff67200cd">qme6</a>=1.0e-7,  <a class="code" href="group__module__radiation__driver.html#ga0b0bf0fa8723b80d0891ec3327d187d7">epsq</a>=1.0e-12)</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">!     parameter (QMIN=1.0e-10, QME5=1.0e-20, QME6=1.0e-20, EPSQ=1.0e-12)</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#ga3fc43ca0d2c5f69a380ddb4f0926ecc7">  373</a></span>&#160;      <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="group__module__radiation__driver.html#ga3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a> = 1.0e-6</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#ga9ee6a89464bf206cc07ea30d7eeaaeb8">  377</a></span>&#160;      <span class="keywordtype">integer</span> :: <a class="code" href="group__module__radiation__driver.html#ga9ee6a89464bf206cc07ea30d7eeaaeb8">itsfc</a>  =0</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#gac4baf8ff048aaa5b85d03cc42c579c7b">  380</a></span>&#160;      <span class="keywordtype">integer</span> :: <a class="code" href="group__module__radiation__driver.html#ga6eb268f296c77047f389ed6fac5f95be">month0</a>=0,   <a class="code" href="group__module__radiation__driver.html#ga4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a>=0,   <a class="code" href="group__module__radiation__driver.html#gac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a>=0</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#gaf6e0e1ef2ebb78f57c897ebaf633edd2">  385</a></span>&#160;      <span class="keywordtype">logical</span> :: <a class="code" href="group__module__radiation__driver.html#gaf6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> =.true.</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#gaab2535e9906afd709124056f4ca1e470">  389</a></span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="group__module__radiation__driver.html#gaab2535e9906afd709124056f4ca1e470">ltp</a> = 0   <span class="comment">! no extra top layer</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">!     integer, parameter :: LTP = 1   ! add an extra top layer</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">  393</a></span>&#160;      <span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a> = (<a class="code" href="group__module__radiation__driver.html#gaab2535e9906afd709124056f4ca1e470">ltp</a> &gt; 0)</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">!  ---  publicly accessible module programs:</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordtype">public</span> <a class="code" href="group__module__radiation__driver.html#ga3d4ef1d77b7d7ef09fafcb4413e1cbf2">radinit</a>, <a class="code" href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">radupdate</a>, <a class="code" href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a">gfs_radiation_driver</a></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keyword">contains</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radiation__driver.html#ga3d4ef1d77b7d7ef09fafcb4413e1cbf2">radinit</a>( si, NLAY, imp_physics, me )</div><div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#ga3d4ef1d77b7d7ef09fafcb4413e1cbf2">  417</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">!     &amp;     ( si, NLAY, imp_physics, me )</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">!          ( none )</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">! =================   subprogram documentation block   ================ !</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">! subprogram:   radinit     initialization of radiation calculations    !</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">! usage:        call radinit                                            !</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">! attributes:                                                           !</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">!   language:  fortran 90                                               !</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">!   machine:   wcoss                                                   !</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">!  ====================  definition of variables  ====================  !</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">! input parameters:                                                     !</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">!   si               : model vertical sigma interface                   !</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">!   NLAY             : number of model vertical layers                  !</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">!   imp_physics      : MP identifier                                    !</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">!   me               : print control flag                               !</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">!  outputs: (none)                                                      !</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">!  external module variables:  (in module physparam)                     !</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">!   isolar   : solar constant cntrol flag                               !</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">!              = 0: use the old fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">!              =10: use the new fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">!              = 1: use noaa ann-mean tsi tbl abs-scale with cycle apprx!</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">!              = 2: use noaa ann-mean tsi tbl tim-scale with cycle apprx!</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">!              = 3: use cmip5 ann-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">!              = 4: use cmip5 mon-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">!   iaerflg  : 3-digit aerosol flag (abc for volc, lw, sw)              !</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">!              a:=0 use background stratospheric aerosol                !</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">!                =1 include stratospheric vocanic aeros                 !</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">!              b:=0 no topospheric aerosol in lw radiation              !</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">!                =1 compute tropspheric aero in 1 broad band for lw     !</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">!                =2 compute tropspheric aero in multi bands for lw      !</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">!              c:=0 no topospheric aerosol in sw radiation              !</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">!                =1 include tropspheric aerosols for sw                 !</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">!   ico2flg  : co2 data source control flag                             !</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">!              =0: use prescribed global mean co2 (old  oper)           !</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">!              =1: use observed co2 annual mean value only              !</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">!              =2: use obs co2 monthly data with 2-d variation          !</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">!   ictmflg  : =yyyy#, external data ic time/date control flag          !</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">!              =   -2: same as 0, but superimpose seasonal cycle        !</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">!                      from climatology data set.                       !</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">!              =   -1: use user provided external data for the          !</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">!                      forecast time, no extrapolation.                 !</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">!              =    0: use data at initial cond time, if not            !</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">!                      available, use latest, no extrapolation.         !</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">!              =    1: use data at the forecast time, if not            !</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">!                      available, use latest and extrapolation.         !</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">!              =yyyy0: use yyyy data for the forecast time,             !</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">!                      no further data extrapolation.                   !</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">!              =yyyy1: use yyyy data for the fcst. if needed, do        !</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">!                      extrapolation to match the fcst time.            !</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">!   ioznflg  : ozone data source control flag                           !</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">!              =0: use climatological ozone profile                     !</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">!              =1: use interactive ozone profile                        !</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">!   ialbflg  : albedo scheme control flag                               !</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">!              =0: climatology, based on surface veg types              !</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">!              =1: modis retrieval based surface albedo scheme          !</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">!   iemsflg  : emissivity scheme cntrl flag (ab 2-digit integer)        !</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">!              a:=0 set sfc air/ground t same for lw radiation          !</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">!                =1 set sfc air/ground t diff for lw radiation          !</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">!              b:=0 use fixed sfc emissivity=1.0 (black-body)           !</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">!                =1 use varying climtology sfc emiss (veg based)        !</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">!                =2 future development (not yet)                        !</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">!   icldflg  : cloud optical property scheme control flag               !</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">!              =0: use diagnostic cloud scheme                          !</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">!              =1: use prognostic cloud scheme (default)                !</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">!   imp_physics  : cloud microphysics scheme control flag                   !</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">!              =99 zhao/carr/sundqvist microphysics scheme               !</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">!              =98 zhao/carr/sundqvist microphysics+pdf cloud &amp; cnvc,cnvw!</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">!              =11 GFDL cloud microphysics                               !</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">!              =8 Thompson microphysics scheme                          !</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">!              =6 WSM6 microphysics scheme                              !</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">!              =10 MG microphysics scheme                                !</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">!   iovrsw   : control flag for cloud overlap in sw radiation           !</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">!   iovrlw   : control flag for cloud overlap in lw radiation           !</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">!              =0: random overlapping clouds                            !</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">!              =1: max/ran overlapping clouds                           !</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">!   isubcsw  : sub-column cloud approx control flag in sw radiation     !</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">!   isubclw  : sub-column cloud approx control flag in lw radiation     !</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">!              =0: with out sub-column cloud approximation              !</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">!              =1: mcica sub-col approx. prescribed random seed         !</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">!              =2: mcica sub-col approx. provided random seed           !</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">!   lcrick   : control flag for eliminating CRICK                       !</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">!              =t: apply layer smoothing to eliminate CRICK             !</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">!              =f: do not apply layer smoothing                         !</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">!   lcnorm   : control flag for in-cld condensate                       !</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">!              =t: normalize cloud condensate                           !</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">!              =f: not normalize cloud condensate                       !</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">!   lnoprec  : precip effect in radiation flag (ferrier microphysics)   !</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">!              =t: snow/rain has no impact on radiation                 !</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">!              =f: snow/rain has impact on radiation                    !</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">!   ivflip   : vertical index direction control flag                    !</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">!              =0: index from toa to surface                            !</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">!              =1: index from surface to toa                            !</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">!  subroutines called: sol_init, aer_init, gas_init, cld_init,          !</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">!                      sfc_init, rlwinit, rswinit                       !</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">!  usage:       call radinit                                            !</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">!  ===================================================================  !</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: NLAY, me, imp_physics </div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: si(:)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">!  ---  outputs: (none, to module variables)</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="group__module__radiation__driver.html#ga9ee6a89464bf206cc07ea30d7eeaaeb8">itsfc</a>  = iemsflg / 10             <span class="comment">! sfc air/ground temp control</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <a class="code" href="group__module__radiation__driver.html#gaf6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> = (ioznflg == 0)           <span class="comment">! first-time clim ozone data read flag</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <a class="code" href="group__module__radiation__driver.html#ga6eb268f296c77047f389ed6fac5f95be">month0</a> = 0</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <a class="code" href="group__module__radiation__driver.html#ga4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a> = 0</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <a class="code" href="group__module__radiation__driver.html#gac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a> = 0</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">if</span> (me == 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">!       print *,&#39; NEW RADIATION PROGRAM STRUCTURES -- SEP 01 2004&#39;</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        print *,<span class="stringliteral">&#39; NEW RADIATION PROGRAM STRUCTURES BECAME OPER. &#39;</span>,      &amp;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;     &amp;          <span class="stringliteral">&#39;  May 01 2007&#39;</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        print *, <a class="code" href="namespacemodule__radiation__driver.html#a70a36595385cf1f5794f9c5859e52ab6">vtagrad</a>                <span class="comment">!print out version tag</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        print *,<span class="stringliteral">&#39; - Selected Control Flag settings: ICTMflg=&#39;</span>,ictmflg,  &amp;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;     &amp;    <span class="stringliteral">&#39; ISOLar =&#39;</span>,isolar, <span class="stringliteral">&#39; ICO2flg=&#39;</span>,ico2flg,<span class="stringliteral">&#39; IAERflg=&#39;</span>,iaerflg,  &amp;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;     &amp;    <span class="stringliteral">&#39; IALBflg=&#39;</span>,ialbflg,<span class="stringliteral">&#39; IEMSflg=&#39;</span>,iemsflg,<span class="stringliteral">&#39; ICLDflg=&#39;</span>,icldflg,  &amp;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;     &amp;    <span class="stringliteral">&#39; IMP_PHYSICS=&#39;</span>,imp_physics,<span class="stringliteral">&#39; IOZNflg=&#39;</span>,ioznflg</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        print *,<span class="stringliteral">&#39; IVFLIP=&#39;</span>,ivflip,<span class="stringliteral">&#39; IOVRSW=&#39;</span>,iovrsw,<span class="stringliteral">&#39; IOVRLW=&#39;</span>,iovrlw,  &amp;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;     &amp;    <span class="stringliteral">&#39; ISUBCSW=&#39;</span>,isubcsw,<span class="stringliteral">&#39; ISUBCLW=&#39;</span>,isubclw</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">!       write(0,*)&#39; IVFLIP=&#39;,ivflip,&#39; IOVRSW=&#39;,iovrsw,&#39; IOVRLW=&#39;,iovrlw,&amp;</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">!    &amp;    &#39; ISUBCSW=&#39;,isubcsw,&#39; ISUBCLW=&#39;,isubclw</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        print *,<span class="stringliteral">&#39; LCRICK=&#39;</span>,lcrick,<span class="stringliteral">&#39; LCNORM=&#39;</span>,lcnorm,<span class="stringliteral">&#39; LNOPREC=&#39;</span>,lnoprec</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        print *,<span class="stringliteral">&#39; LTP =&#39;</span>,<a class="code" href="group__module__radiation__driver.html#gaab2535e9906afd709124056f4ca1e470">ltp</a>,<span class="stringliteral">&#39;, add extra top layer =&#39;</span>,<a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">if</span> ( ictmflg==0 .or. ictmflg==-2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;          print *,<span class="stringliteral">&#39;   Data usage is limited by initial condition!&#39;</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          print *,<span class="stringliteral">&#39;   No volcanic aerosols&#39;</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">if</span> ( isubclw == 0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCLW=&#39;</span>,isubclw,<span class="stringliteral">&#39; No McICA, use grid &#39;</span>,         &amp;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;     &amp;            <span class="stringliteral">&#39;averaged cloud in LW radiation&#39;</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="keywordflow">elseif</span> ( isubclw == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCLW=&#39;</span>,isubclw,<span class="stringliteral">&#39; Use McICA with fixed &#39;</span>,       &amp;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for LW random number generator&#39;</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">elseif</span> ( isubclw == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCLW=&#39;</span>,isubclw,<span class="stringliteral">&#39; Use McICA with random &#39;</span>,      &amp;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for LW random number generator&#39;</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;          print *,<span class="stringliteral">&#39; - ERROR!!! ISUBCLW=&#39;</span>,isubclw,<span class="stringliteral">&#39; is not a &#39;</span>,          &amp;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;     &amp;            <span class="stringliteral">&#39;valid option &#39;</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          stop</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">if</span> ( isubcsw == 0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCSW=&#39;</span>,isubcsw,<span class="stringliteral">&#39; No McICA, use grid &#39;</span>,         &amp;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;     &amp;            <span class="stringliteral">&#39;averaged cloud in SW radiation&#39;</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">elseif</span> ( isubcsw == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCSW=&#39;</span>,isubcsw,<span class="stringliteral">&#39; Use McICA with fixed &#39;</span>,       &amp;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for SW random number generator&#39;</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">elseif</span> ( isubcsw == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCSW=&#39;</span>,isubcsw,<span class="stringliteral">&#39; Use McICA with random &#39;</span>,      &amp;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for SW random number generator&#39;</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;          print *,<span class="stringliteral">&#39; - ERROR!!! ISUBCSW=&#39;</span>,isubcsw,<span class="stringliteral">&#39; is not a &#39;</span>,          &amp;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;     &amp;            <span class="stringliteral">&#39;valid option &#39;</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;          stop</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">if</span> ( isubcsw /= isubclw ) <span class="keywordflow">then</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;          print *,<span class="stringliteral">&#39; - *** Notice *** ISUBCSW /= ISUBCLW !!!&#39;</span>,           &amp;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;     &amp;            isubcsw, isubclw</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">!     Initialization</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="keyword">call </span>sol_init ( me )          <span class="comment">!  --- ...  astronomy initialization routine</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keyword">call </span>aer_init ( nlay, me )    <span class="comment">!  --- ...  aerosols initialization routine</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="keyword">call </span>gas_init ( me )          <span class="comment">!  --- ...  co2 and other gases initialization routine</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keyword">call </span>sfc_init ( me )          <span class="comment">!  --- ...  surface initialization routine</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keyword">call </span>cld_init ( si, nlay, imp_physics, me) <span class="comment">!  --- ...  cloud initialization routine</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keyword">call </span>rlwinit ( me )           <span class="comment">!  --- ...  lw radiation initialization routine</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keyword">call </span>rswinit ( me )           <span class="comment">!  --- ...  sw radiation initialization routine</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radiation__driver.html#ga3d4ef1d77b7d7ef09fafcb4413e1cbf2">radinit</a></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">radupdate</a>( idate,jdate,deltsw,deltim,lsswr, me,        &amp;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;     &amp;                      slag,sdec,cdec,solcon)</div><div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">  667</a></span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">! =================   subprogram documentation block   ================ !</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">! subprogram:   radupdate   calls many update subroutines to check and  !</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">!   update radiation required but time varying data sets and module     !</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">!   variables.                                                          !</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">! usage:        call radupdate                                          !</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">! attributes:                                                           !</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">!   language:  fortran 90                                               !</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">!   machine:   ibm sp                                                   !</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">!  ====================  definition of variables  ====================  !</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">! input parameters:                                                     !</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">!   idate(8)       : ncep absolute date and time of initial condition   !</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">!                    (yr, mon, day, t-zone, hr, min, sec, mil-sec)      !</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">!   jdate(8)       : ncep absolute date and time at fcst time           !</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">!                    (yr, mon, day, t-zone, hr, min, sec, mil-sec)      !</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">!   deltsw         : sw radiation calling frequency in seconds          !</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">!   deltim         : model timestep in seconds                          !</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">!   lsswr          : logical flags for sw radiation calculations        !</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">!   me             : print control flag                                 !</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">!   slag           : equation of time in radians                        !</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">!   sdec, cdec     : sin and cos of the solar declination angle         !</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">!   solcon         : sun-earth distance adjusted solar constant (w/m2)  !</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">!  external module variables:                                           !</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">!   isolar   : solar constant cntrl  (in module physparam)               !</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">!              = 0: use the old fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">!              =10: use the new fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">!              = 1: use noaa ann-mean tsi tbl abs-scale with cycle apprx!</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">!              = 2: use noaa ann-mean tsi tbl tim-scale with cycle apprx!</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">!              = 3: use cmip5 ann-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">!              = 4: use cmip5 mon-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">!   ictmflg  : =yyyy#, external data ic time/date control flag          !</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">!              =   -2: same as 0, but superimpose seasonal cycle        !</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">!                      from climatology data set.                       !</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">!              =   -1: use user provided external data for the          !</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">!                      forecast time, no extrapolation.                 !</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">!              =    0: use data at initial cond time, if not            !</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">!                      available, use latest, no extrapolation.         !</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">!              =    1: use data at the forecast time, if not            !</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">!                      available, use latest and extrapolation.         !</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">!              =yyyy0: use yyyy data for the forecast time,             !</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">!                      no further data extrapolation.                   !</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">!              =yyyy1: use yyyy data for the fcst. if needed, do        !</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">!                      extrapolation to match the fcst time.            !</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">!  module variables:                                                    !</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">!   loz1st   : first-time clim ozone data read flag                     !</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">!  subroutines called: sol_update, aer_update, gas_update               !</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">!  ===================================================================  !</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: idate(:), jdate(:), me</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: lsswr</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: deltsw, deltim</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(out)</span> :: slag, sdec, cdec, solcon</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordtype">integer</span> :: iyear, imon, iday, ihour</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordtype">integer</span> :: kyear, kmon, kday, khour</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordtype">logical</span> :: lmon_chg       <span class="comment">! month change flag</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="keywordtype">logical</span> :: lco2_chg       <span class="comment">! cntrl flag for updating co2 data</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordtype">logical</span> :: lsol_chg       <span class="comment">! cntrl flag for updating solar constant</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">!  --- ...  time stamp at fcst time</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      iyear = jdate(1)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      imon  = jdate(2)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      iday  = jdate(3)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      ihour = jdate(5)</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">!  --- ...  set up time stamp used for green house gases (** currently co2 only)</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">if</span> ( ictmflg==0 .or. ictmflg==-2 ) <span class="keywordflow">then</span>  <span class="comment">! get external data at initial condition time</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        kyear = idate(1)</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        kmon  = idate(2)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        kday  = idate(3)</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        khour = idate(5)</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">else</span>                           <span class="comment">! get external data at fcst or specified time</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        kyear = iyear</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        kmon  = imon</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        kday  = iday</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        khour = ihour</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! end if_ictmflg_block</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#ga6eb268f296c77047f389ed6fac5f95be">month0</a> /= imon ) <span class="keywordflow">then</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        lmon_chg = .true.</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <a class="code" href="group__module__radiation__driver.html#ga6eb268f296c77047f389ed6fac5f95be">month0</a>   = imon</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        lmon_chg = .false.</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordflow">if</span> (lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">if</span> ( isolar == 0 .or. isolar == 10 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          lsol_chg = .false.</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">elseif</span> ( <a class="code" href="group__module__radiation__driver.html#ga4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a> /= iyear ) <span class="keywordflow">then</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;          lsol_chg = .true.</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          lsol_chg = ( isolar==4 .and. lmon_chg )</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <a class="code" href="group__module__radiation__driver.html#ga4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a> = iyear</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keyword">call </span>sol_update                                                 &amp;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;     &amp;     ( jdate,kyear,deltsw,deltim,lsol_chg, me,                    &amp;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;     &amp;       slag,sdec,cdec,solcon                                      &amp;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;     &amp;     )</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="keywordflow">      endif</span>  <span class="comment">! end_if_lsswr_block</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      <span class="keywordflow">if</span> ( lmon_chg ) <span class="keywordflow">then</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keyword">call </span>aer_update ( iyear, imon, me )</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#gac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a> /= kmon ) <span class="keywordflow">then</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <a class="code" href="group__module__radiation__driver.html#gac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a> = kmon</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        lco2_chg = .true.</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        lco2_chg = .false.</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keyword">call </span>gas_update ( kyear,kmon,kday,khour,<a class="code" href="group__module__radiation__driver.html#gaf6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a>,lco2_chg, me )</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#gaf6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> ) <a class="code" href="group__module__radiation__driver.html#gaf6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> = .false.</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">!     call sfc_update ( iyear, imon, me )</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">!     call cld_update ( iyear, imon, me )</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">radupdate</a></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a">gfs_radiation_driver</a>                             &amp;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;         (model, statein, stateout, sfcprop, coupling, grid, tbd, &amp;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;          cldprop, radtend, diag)</div><div class="line"><a name="l01015"></a><span class="lineno"><a class="line" href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a"> 1015</a></span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__control__type.html">gfs_control_type</a>),         <span class="keywordtype">intent(in)</span>    :: Model</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_statein_type</a>),         <span class="keywordtype">intent(in)</span>    :: Statein</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_stateout_type</a>),        <span class="keywordtype">intent(inout)</span> :: Stateout</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_sfcprop_type</a>),         <span class="keywordtype">intent(in)</span>    :: Sfcprop</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_coupling_type</a>),        <span class="keywordtype">intent(inout)</span> :: Coupling</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_grid_type</a>),            <span class="keywordtype">intent(in)</span>    :: Grid</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_tbd_type</a>),             <span class="keywordtype">intent(in)</span>    :: Tbd</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_cldprop_type</a>),         <span class="keywordtype">intent(in)</span>    :: Cldprop</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_radtend_type</a>),         <span class="keywordtype">intent(inout)</span> :: Radtend</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="keywordtype">type</span>(<a class="code" href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_diag_type</a>),            <span class="keywordtype">intent(inout)</span> :: Diag</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        </div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">! =================   subprogram documentation block   ================ !</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">!    this program is the driver of radiation calculation subroutines. * !</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">!    It sets up profile variables for radiation input, including      * !</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">!    clouds, surface albedos, atmospheric aerosols, ozone, etc.       * !</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">!    usage:        call grrad                                         * !</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">!    subprograms called:                                              * !</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">!                  setalb, setemis, setaer, getozn, getgases,         * !</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">!                  progcld1, progcld2, progclduni, diagcds,           * !</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">!                  swrad, lwrad, fpvs                                 * !</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">!    attributes:                                                      * !</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">!      language:   fortran 90                                         * !</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">!      machine:    ibm-sp, sgi                                        * !</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">!  ====================  definition of variables  ====================  !</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">!    input variables:                                                   !</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">!       type(GFS_control_type),         intent(in)    :: Model          !</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">!       type(GFS_statein_type),         intent(in)    :: Statein        !</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">!       type(GFS_sfcprop_type),         intent(in)    :: Sfcprop        !</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">!       type(GFS_grid_type),            intent(in)    :: Grid           !</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">!       type(GFS_tbd_type),             intent(in)    :: Tbd            !</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">!       type(GFS_cldprop_type),         intent(in)    :: Cldprop        !</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">!    input/output variables:                                            !</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">!       type(GFS_coupling_type),        intent(inout) :: Coupling       !</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">!       type(GFS_radtend_type),         intent(inout) :: Radtend        !</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">!       type(GFS_diag_type),            intent(inout) :: Diag           !</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">!    optional:                                                          !</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">!       real(kind=kind_phys), optional, intent(out)   :: htrlw0(:,:)    !</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">!       real(kind=kind_phys), optional, intent(out)   :: htrsw0(:,:)    !</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">!    optional output variables:                                         !</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">!      htrswb(IX,LM,NBDSW) : spectral band total sky sw heating rate    !</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">!      htrlwb(IX,LM,NBDLW) : spectral band total sky lw heating rate    !</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">!    definitions of internal variable arrays:                           !</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">!     1. fixed gases:         (defined in &#39;module_radiation_gases&#39;)     !</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">!          gasvmr(:,:,1)  -  co2 volume mixing ratio                    !</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">!          gasvmr(:,:,2)  -  n2o volume mixing ratio                    !</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">!          gasvmr(:,:,3)  -  ch4 volume mixing ratio                    !</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">!          gasvmr(:,:,4)  -  o2  volume mixing ratio                    !</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">!          gasvmr(:,:,5)  -  co  volume mixing ratio                    !</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">!          gasvmr(:,:,6)  -  cf11 volume mixing ratio                   !</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">!          gasvmr(:,:,7)  -  cf12 volume mixing ratio                   !</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">!          gasvmr(:,:,8)  -  cf22 volume mixing ratio                   !</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">!          gasvmr(:,:,9)  -  ccl4 volume mixing ratio                   !</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">!     2. cloud profiles:      (defined in &#39;module_radiation_clouds&#39;)    !</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">!                ---  for  prognostic cloud  ---                        !</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">!          clouds(:,:,1)  -  layer total cloud fraction                 !</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">!          clouds(:,:,2)  -  layer cloud liq water path                 !</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">!          clouds(:,:,3)  -  mean effective radius for liquid cloud     !</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">!          clouds(:,:,4)  -  layer cloud ice water path                 !</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">!          clouds(:,:,5)  -  mean effective radius for ice cloud        !</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">!          clouds(:,:,6)  -  layer rain drop water path                 !</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">!          clouds(:,:,7)  -  mean effective radius for rain drop        !</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">!          clouds(:,:,8)  -  layer snow flake water path                !</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">!          clouds(:,:,9)  -  mean effective radius for snow flake       !</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">!                ---  for  diagnostic cloud  ---                        !</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment">!          clouds(:,:,1)  -  layer total cloud fraction                 !</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">!          clouds(:,:,2)  -  layer cloud optical depth                  !</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">!          clouds(:,:,3)  -  layer cloud single scattering albedo       !</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">!          clouds(:,:,4)  -  layer cloud asymmetry factor               !</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">!     3. surface albedo:      (defined in &#39;module_radiation_surface&#39;)   !</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">!          sfcalb( :,1 )  -  near ir direct beam albedo                 !</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">!          sfcalb( :,2 )  -  near ir diffused albedo                    !</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">!          sfcalb( :,3 )  -  uv+vis direct beam albedo                  !</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">!          sfcalb( :,4 )  -  uv+vis diffused albedo                     !</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">!     4. sw aerosol profiles: (defined in &#39;module_radiation_aerosols&#39;)  !</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">!          faersw(:,:,:,1)-  sw aerosols optical depth                  !</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">!          faersw(:,:,:,2)-  sw aerosols single scattering albedo       !</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">!          faersw(:,:,:,3)-  sw aerosols asymmetry parameter            !</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">!     5. lw aerosol profiles: (defined in &#39;module_radiation_aerosols&#39;)  !</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">!          faerlw(:,:,:,1)-  lw aerosols optical depth                  !</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">!          faerlw(:,:,:,2)-  lw aerosols single scattering albedo       !</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">!          faerlw(:,:,:,3)-  lw aerosols asymmetry parameter            !</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">!     6. sw fluxes at toa:    (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">!        (topfsw_type -- derived data type for toa rad fluxes)          !</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">!          topfsw(:)%upfxc  -  total sky upward flux at toa             !</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">!          topfsw(:)%dnfxc  -  total sky downward flux at toa           !</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">!          topfsw(:)%upfx0  -  clear sky upward flux at toa             !</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">!     7. lw fluxes at toa:    (defined in &#39;module_radlw_main&#39;)          !</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">!        (topflw_type -- derived data type for toa rad fluxes)          !</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">!          topflw(:)%upfxc  -  total sky upward flux at toa             !</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">!          topflw(:)%upfx0  -  clear sky upward flux at toa             !</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">!     8. sw fluxes at sfc:    (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">!        (sfcfsw_type -- derived data type for sfc rad fluxes)          !</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">!          sfcfsw(:)%upfxc  -  total sky upward flux at sfc             !</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">!          sfcfsw(:)%dnfxc  -  total sky downward flux at sfc           !</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">!          sfcfsw(:)%upfx0  -  clear sky upward flux at sfc             !</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">!          sfcfsw(:)%dnfx0  -  clear sky downward flux at sfc           !</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">!     9. lw fluxes at sfc:    (defined in &#39;module_radlw_main&#39;)          !</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">!        (sfcflw_type -- derived data type for sfc rad fluxes)          !</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">!          sfcflw(:)%upfxc  -  total sky upward flux at sfc             !</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">!          sfcflw(:)%dnfxc  -  total sky downward flux at sfc           !</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">!          sfcflw(:)%dnfx0  -  clear sky downward flux at sfc           !</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">!! optional radiation outputs:                                          !</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">!!   10. sw flux profiles:    (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">!!       (profsw_type -- derived data type for rad vertical profiles)   !</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">!!         fswprf(:,:)%upfxc - total sky upward flux                    !</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">!!         fswprf(:,:)%dnfxc - total sky downward flux                  !</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">!!         fswprf(:,:)%upfx0 - clear sky upward flux                    !</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">!!         fswprf(:,:)%dnfx0 - clear sky downward flux                  !</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">!!                                                                      !</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">!!   11. lw flux profiles:    (defined in &#39;module_radlw_main&#39;)          !</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">!!       (proflw_type -- derived data type for rad vertical profiles)   !</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">!!         flwprf(:,:)%upfxc - total sky upward flux                    !</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">!!         flwprf(:,:)%dnfxc - total sky downward flux                  !</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">!!         flwprf(:,:)%upfx0 - clear sky upward flux                    !</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">!!         flwprf(:,:)%dnfx0 - clear sky downward flux                  !</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">!!                                                                      !</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">!!   12. sw sfc components:   (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">!!       (cmpfsw_type -- derived data type for component sfc fluxes)    !</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">!!         scmpsw(:)%uvbfc  -  total sky downward uv-b flux at sfc      !</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">!!         scmpsw(:)%uvbf0  -  clear sky downward uv-b flux at sfc      !</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">!!         scmpsw(:)%nirbm  -  total sky sfc downward nir direct flux   !</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">!!         scmpsw(:)%nirdf  -  total sky sfc downward nir diffused flux !</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">!!         scmpsw(:)%visbm  -  total sky sfc downward uv+vis direct flx !</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">!!         scmpsw(:)%visdf  -  total sky sfc downward uv+vis diff flux  !</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">!    external module variables:                                         !</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">!     ivflip           : control flag for in/out vertical indexing      !</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">!                        =0 index from toa to surface                   !</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">!                        =1 index from surface to toa                   !</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">!     imp_physics      : cloud microphysics scheme control flag         !</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">!                        =99 zhao/carr/sundqvist microphysics scheme     !</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">!                        =98 zhao/carr/sundqvist microphysics +pdf cloud !</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">!                        =11 GFDL cloud microphysics                     !</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">!                        =8 Thompson cloud microphysics                 !</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">!                        =6 WSM6 cloud microphysics                     !</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">!                        =10 MG cloud microphysics                       !</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">!    module variables:                                                  !</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">!     itsfc            : =0 use same sfc skin-air/ground temp           !</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">!                        =1 use diff sfc skin-air/ground temp (not yet) !</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">!  ======================  end of definitions  =======================  !</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">!  ---  local variables: (horizontal dimensioned by IM)</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="comment">!--- INTEGER VARIABLES</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="keywordtype">integer</span> :: me, im, lm, nfxr, ntrac</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <span class="keywordtype">integer</span> :: i, j, k, k1, lv, itop, ibtc, nday, LP1, LMK, LMP, kd,  &amp;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                 lla, llb, lya, lyb, kt, kb, n, ntcw, ntiw, ncld, ntrw, &amp;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                 ntsw, ntgl</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(size(Grid%xlon,1))</span>   :: idxday</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),3)</span> :: mbota, mtopa</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="comment">!--- REAL VARIABLES</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span> :: raddt, es, qs, delt, tem0d, tem1, tem2</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1))</span> ::             &amp;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;           tsfa, cvt1, cvb1, tem1d, tsfg, tskn</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),5)</span>       :: cldsa</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),NSPC1)</span>   :: aerodp</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),NF_ALBD)</span> :: sfcalb</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp)</span> :: &amp;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;           htswc, htlwc, gcice, grain, grime, htsw0, htlw0, plyr, tlyr,    &amp;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;           qlyr, olyr, rhly, tvly,qstl, vvel, prslk1, tem2da,              &amp;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;           tem2db, cldcov, deltaq, cnvc, cnvw, effrl, effri, effrr, effrs</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp+1)</span> :: plvl, tlvl</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp,2:Model%ntrac)</span> :: tracer1</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp,NF_CLDS)</span>       :: clouds</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp,NF_VGAS)</span>       :: gasvmr</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp,NBDSW,NF_AESW)</span> ::faersw</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp,NBDLW,NF_AELW)</span> ::faerlw</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">dimension(size(Grid%xlon,1),Model%levr+ltp,Model%ncnd)</span>    :: ccnd</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="comment">!--- TYPED VARIABLES</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      type(cmpfsw_type),    <span class="keywordtype">dimension(size(Grid%xlon,1))</span> :: scmpsw</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment">!     logical effr_in</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">!     data effr_in/.false./</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">!--- set commonly used integers</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      me    = model%me</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      lm    = model%levr</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      im    = <span class="keyword">size</span>(grid%xlon,1)</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      nfxr  = model%nfxr</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      ntrac = model%ntrac        <span class="comment">! tracers in grrad strip off sphum - start tracer1(2:NTRAC)</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      ntcw  = model%ntcw</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      ntiw  = model%ntiw</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      ncld  = model%ncld</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      ntrw  = model%ntrw</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      ntsw  = model%ntsw</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      ntgl  = model%ntgl</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      lp1   = lm + 1             <span class="comment">! num of in/out levels</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">!  --- ...  set local /level/layer indexes corresponding to in/out variables</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      lmk = lm + <a class="code" href="group__module__radiation__driver.html#gaab2535e9906afd709124056f4ca1e470">ltp</a>             <span class="comment">! num of local layers</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      lmp = lmk + 1              <span class="comment">! num of local levels</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        <span class="keywordflow">if</span> ( ivflip == 1 ) <span class="keywordflow">then</span>  <span class="comment">! vertical from sfc upward</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;          kd  = 0                <span class="comment">! index diff between in/out and local</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;          kt  = 1                <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          kb  = 0                <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;          lla = lmk              <span class="comment">! local index at the 2nd level from top</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;          llb = lmp              <span class="comment">! local index at toa level</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;          lya = lm               <span class="comment">! local index for the 2nd layer from top</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;          lyb = lp1              <span class="comment">! local index for the top layer</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        <span class="keywordflow">else</span>                     <span class="comment">! vertical from toa downward</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;          kd  = 1                <span class="comment">! index diff between in/out and local</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;          kt  = 0                <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          kb  = 1                <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          lla = 2                <span class="comment">! local index at the 2nd level from top</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;          llb = 1                <span class="comment">! local index at toa level</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;          lya = 2                <span class="comment">! local index for the 2nd layer from top</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;          lyb = 1                <span class="comment">! local index for the top layer</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="keywordflow">        endif</span>                    <span class="comment">! end if_ivflip_block</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        kd = 0</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="keywordflow">if</span> ( ivflip == 1 ) <span class="keywordflow">then</span>  <span class="comment">! vertical from sfc upward</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;          kt = 1                 <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;          kb = 0                 <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        <span class="keywordflow">else</span>                     <span class="comment">! vertical from toa downward</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;          kt = 0                 <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;          kb = 1                 <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="keywordflow">        endif</span>                    <span class="comment">! end if_ivflip_block</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! end if_lextop_block</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      raddt = min(model%fhswr, model%fhlwr)</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">!     print *,&#39; in grrad : raddt=&#39;,raddt</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#ga9ee6a89464bf206cc07ea30d7eeaaeb8">itsfc</a> == 0 ) <span class="keywordflow">then</span>            <span class="comment">! use same sfc skin-air/ground temp</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;          tskn(i) = sfcprop%tsfc(i)</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;          tsfg(i) = sfcprop%tsfc(i)</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">else</span>                              <span class="comment">! use diff sfc skin-air/ground temp</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;          tskn(i) = sfcprop%tsfc(i)</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;          tsfg(i) = sfcprop%tsfc(i)</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">!           convert pressure unit from pa to mb</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        k1 = k + kd</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          plvl(i,k1)   = 0.01 * statein%prsi(i,k)   <span class="comment">! pa to mb (hpa)</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;          plyr(i,k1)   = 0.01 * statein%prsl(i,k)   <span class="comment">! pa to mb (hpa)</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          tlyr(i,k1)   = statein%tgrs(i,k)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;          prslk1(i,k1) = statein%prslk(i,k)</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">!         es  = min( Statein%prsl(i,k), 0.001 * fpvs( Statein%tgrs(i,k) ) )   ! fpvs in pa</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;          es  = min( statein%prsl(i,k),  fpvs( statein%tgrs(i,k) ) )  <span class="comment">! fpvs and prsl in pa</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;          qs  = max( <a class="code" href="group__module__radiation__driver.html#gafdc2a7e1dbfb075ac33a2388564d9428">qmin</a>, eps * es / (statein%prsl(i,k) + epsm1*es) )</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;          rhly(i,k1) = max( 0.0, min( 1.0, max(<a class="code" href="group__module__radiation__driver.html#gafdc2a7e1dbfb075ac33a2388564d9428">qmin</a>, statein%qgrs(i,k,1))/qs ) )</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;          qstl(i,k1) = qs</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      <span class="comment">!--- recast remaining all tracers (except sphum) forcing them all to be positive</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <span class="keywordflow">do</span> j = 2, ntrac</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          tracer1(:,k1,j) = max(0.0, statein%qgrs(:,k,j))</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        plvl(i,lp1+kd) = 0.01 * statein%prsi(i,lp1)  <span class="comment">! pa to mb (hpa)</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      <span class="keywordflow">if</span> (model%levr &lt; model%levs) <span class="keywordflow">then</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;          plvl(i,lp1+kd) = 0.01 * statein%prsi(i,model%levs+1)  <span class="comment">! pa to mb (hpa)</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;          plvl(i,lm+kd)  = 0.5 * (plvl(i,lp1+kd) + plvl(i,lm+kd))</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span>                 <span class="comment">! values for extra top layer</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          plvl(i,llb) = <a class="code" href="group__module__radiation__driver.html#ga3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;          <span class="keywordflow">if</span> ( plvl(i,lla) &lt;= <a class="code" href="group__module__radiation__driver.html#ga3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a> ) plvl(i,lla) = 2.0*<a class="code" href="group__module__radiation__driver.html#ga3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;          plyr(i,lyb)   = 0.5 * plvl(i,lla)</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;          tlyr(i,lyb)   = tlyr(i,lya)</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;          prslk1(i,lyb) = (plyr(i,lyb)*0.00001) ** rocp <span class="comment">! plyr in Pa</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;          rhly(i,lyb)   = rhly(i,lya)</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;          qstl(i,lyb)   = qstl(i,lya)</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">!  ---  note: may need to take care the top layer amount</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;       tracer1(:,lyb,:) = tracer1(:,lya,:)</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="keywordflow">if</span> (model%ntoz &gt; 0) <span class="keywordflow">then</span>            <span class="comment">! interactive ozone generation</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;          <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            olyr(i,k) = max( <a class="code" href="group__module__radiation__driver.html#gafdc2a7e1dbfb075ac33a2388564d9428">qmin</a>, tracer1(i,k,model%ntoz) )</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      <span class="keywordflow">else</span>                                <span class="comment">! climatological ozone</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keyword">call </span>getozn (prslk1, grid%xlat, im, lmk,    &amp;     <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                     olyr)                                <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="keywordflow">      endif</span>                               <span class="comment">! end_if_ntoz</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="keyword">call </span>coszmn (grid%xlon,grid%sinlat,           &amp;     <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                   grid%coslat,model%solhr, im, me, &amp; </div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                   radtend%coszen, radtend%coszdg)        <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">!  - gasvmr(:,:,1)  -  co2 volume mixing ratio</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">!  - gasvmr(:,:,2)  -  n2o volume mixing ratio</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">!  - gasvmr(:,:,3)  -  ch4 volume mixing ratio</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">!  - gasvmr(:,:,4)  -  o2  volume mixing ratio</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">!  - gasvmr(:,:,5)  -  co  volume mixing ratio</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">!  - gasvmr(:,:,6)  -  cf11 volume mixing ratio</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">!  - gasvmr(:,:,7)  -  cf12 volume mixing ratio</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">!  - gasvmr(:,:,8)  -  cf22 volume mixing ratio</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">!  - gasvmr(:,:,9)  -  ccl4 volume mixing ratio</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">!  --- ...  set up non-prognostic gas volume mixing ratioes</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <span class="keyword">call </span>getgases (plvl, grid%xlon, grid%xlat, im, lmk,  &amp; <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                     gasvmr)                                 <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">do</span> k = 2, lmk</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;          tem2da(i,k) = log( plyr(i,k) )</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;          tem2db(i,k) = log( plvl(i,k) )</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <span class="keywordflow">if</span> (ivflip == 0) <span class="keywordflow">then</span>              <span class="comment">! input data from toa to sfc</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;          tem1d(i)   = <a class="code" href="group__module__radiation__driver.html#ga4916e37c472b2f824b6f566ff67200cd">qme6</a></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;          tem2da(i,1) = log( plyr(i,1) )</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;          tem2db(i,1) = 1.0</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;          tsfa(i)   = tlyr(i,lmk)                  <span class="comment">! sfc layer air temp</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;          tlvl(i,1)   = tlyr(i,1)</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;          tlvl(i,lmp) = tskn(i)</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;            qlyr(i,k1) = max( tem1d(i), statein%qgrs(i,k,1) )</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;            tem1d(i)   = min( <a class="code" href="group__module__radiation__driver.html#gab671cb80142c71dab5f41f01ccdcc088">qme5</a>, qlyr(i,k1) )</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;            tvly(i,k1) = statein%tgrs(i,k) * (1.0 + fvirt*qlyr(i,k1)) <span class="comment">! virtual T (K)</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            qlyr(i,lyb) = qlyr(i,lya)</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;            tvly(i,lyb) = tvly(i,lya)</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="keywordflow">do</span> k = 2, lmk</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            tlvl(i,k) = tlyr(i,k) + (tlyr(i,k-1) - tlyr(i,k))           &amp;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;     &amp;                * (tem2db(i,k)   - tem2da(i,k))                   &amp;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;     &amp;                / (tem2da(i,k-1) - tem2da(i,k))</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <span class="keywordflow">else</span>                               <span class="comment">! input data from sfc to toa</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;          tem1d(i)   = <a class="code" href="group__module__radiation__driver.html#ga4916e37c472b2f824b6f566ff67200cd">qme6</a></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;          tem2da(i,1) = log( plyr(i,1) )</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;          tem2db(i,1) = log( plvl(i,1) )</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;          tsfa(i)   = tlyr(i,1)                    <span class="comment">! sfc layer air temp</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;          tlvl(i,1)   = tskn(i)</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;          tlvl(i,lmp) = tlyr(i,lmk)</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <span class="keywordflow">do</span> k = lm, 1, -1</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            qlyr(i,k) = max( tem1d(i), statein%qgrs(i,k,1) )</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            tem1d(i)  = min( <a class="code" href="group__module__radiation__driver.html#gab671cb80142c71dab5f41f01ccdcc088">qme5</a>, qlyr(i,k) )</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            tvly(i,k) = statein%tgrs(i,k) * (1.0 + fvirt*qlyr(i,k)) <span class="comment">! virtual T (K)</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            qlyr(i,lyb) = qlyr(i,lya)</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;            tvly(i,lyb) = tvly(i,lya)</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordflow">do</span> k = 1, lmk-1</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            tlvl(i,k+1) = tlyr(i,k) + (tlyr(i,k+1) - tlyr(i,k))         &amp;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;     &amp;                  * (tem2db(i,k+1) - tem2da(i,k))                 &amp;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;     &amp;                  / (tem2da(i,k+1) - tem2da(i,k))</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="keywordflow">      endif</span>                              <span class="comment">! end_if_ivflip</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      nday = 0</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordflow">if</span> (radtend%coszen(i) &gt;= 0.0001) <span class="keywordflow">then</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;          nday = nday + 1</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;          idxday(nday) = i</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">!check  print *,&#39; in grrad : calling setaer &#39;</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      <span class="keyword">call </span>setaer (plvl, plyr, prslk1, tvly, rhly, sfcprop%slmsk,  &amp;  <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                   tracer1, grid%xlon, grid%xlat, im, lmk, lmp,    &amp;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                   model%lsswr,model%lslwr,                        &amp;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                   faersw,faerlw,aerodp)                              <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment">!  --- ...  obtain cloud information for radiation calculations</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      <span class="keywordflow">if</span> (ntcw &gt; 0) <span class="keywordflow">then</span>                                          <span class="comment">! prognostic cloud schemes</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        <span class="keywordflow">if</span> (model%ncnd == 1) <span class="keywordflow">then</span>                                 <span class="comment">! Zhao_Carr_Sundqvist</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;          <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;              ccnd(i,k,1) = tracer1(i,k,ntcw)                     <span class="comment">! liquid water/ice</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <span class="keywordflow">elseif</span> (model%ncnd == 2) <span class="keywordflow">then</span>                             <span class="comment">! MG</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;          <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;              ccnd(i,k,1) = tracer1(i,k,ntcw)                     <span class="comment">! liquid water</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;              ccnd(i,k,2) = tracer1(i,k,ntiw)                     <span class="comment">! ice water</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        <span class="keywordflow">elseif</span> (model%ncnd == 4) <span class="keywordflow">then</span>                             <span class="comment">! MG2</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;          <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;              ccnd(i,k,1) = tracer1(i,k,ntcw)                     <span class="comment">! liquid water</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;              ccnd(i,k,2) = tracer1(i,k,ntiw)                     <span class="comment">! ice water</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;              ccnd(i,k,3) = tracer1(i,k,ntrw)                     <span class="comment">! rain water</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;              ccnd(i,k,4) = tracer1(i,k,ntsw)                     <span class="comment">! snow water</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        <span class="keywordflow">elseif</span> (model%ncnd == 5) <span class="keywordflow">then</span>                             <span class="comment">! GFDL MP, Thompson, MG3</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;          <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;              ccnd(i,k,1) = tracer1(i,k,ntcw)                     <span class="comment">! liquid water</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;              ccnd(i,k,2) = tracer1(i,k,ntiw)                     <span class="comment">! ice water</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;              ccnd(i,k,3) = tracer1(i,k,ntrw)                     <span class="comment">! rain water</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;              ccnd(i,k,4) = tracer1(i,k,ntsw) + tracer1(i,k,ntgl) <span class="comment">! snow + grapuel</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">do</span> n=1,model%ncnd</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;          <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;              <span class="keywordflow">if</span> (ccnd(i,k,n) &lt; <a class="code" href="group__module__radiation__driver.html#ga0b0bf0fa8723b80d0891ec3327d187d7">epsq</a>) ccnd(i,k,n) = 0.0</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <span class="keywordflow">if</span> (model%imp_physics == 11 ) <span class="keywordflow">then</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;          <span class="keywordflow">if</span> (.not. model%lgfdlmprad) <span class="keywordflow">then</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">! rsun the  summation methods and order make the difference in calculation </span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment">!            clw(:,:) = clw(:,:) + tracer1(:,1:LMK,Model%ntcw)   &amp;        </span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">!                                + tracer1(:,1:LMK,Model%ntiw)   &amp; </span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">!                                + tracer1(:,1:LMK,Model%ntrw)   &amp; </span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">!                                + tracer1(:,1:LMK,Model%ntsw)   &amp; </span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment">!                                + tracer1(:,1:LMK,Model%ntgl) </span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;            ccnd(:,:,1) =               tracer1(:,1:lmk,ntcw)</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            ccnd(:,:,1) = ccnd(:,:,1) + tracer1(:,1:lmk,ntrw)</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            ccnd(:,:,1) = ccnd(:,:,1) + tracer1(:,1:lmk,ntiw)</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            ccnd(:,:,1) = ccnd(:,:,1) + tracer1(:,1:lmk,ntsw)</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            ccnd(:,:,1) = ccnd(:,:,1) + tracer1(:,1:lmk,ntgl)</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            <span class="keywordflow">do</span> j=1,model%ncld</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;              ccnd(:,:,1) = ccnd(:,:,1) + tracer1(:,1:lmk,ntcw+j-1) <span class="comment">! cloud condensate amount</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="keywordflow">          endif</span> </div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;          <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;              <span class="keywordflow">if</span> (ccnd(i,k,1) &lt; <a class="code" href="group__module__radiation__driver.html#ga0b0bf0fa8723b80d0891ec3327d187d7">epsq</a> ) ccnd(i,k,1) = 0.0</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="keywordflow">        endif</span> </div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        <span class="keywordflow">if</span> (model%shoc_cld) <span class="keywordflow">then</span>                                        <span class="comment">! all but MG microphys</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;          cldcov(1:im,1+kd:lm+kd) = tbd%phy_f3d(1:im,1:lm,model%ntot3d-2)</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;          <span class="keywordflow">if</span> (ncld == 2 .and. model%effr_in) <span class="keywordflow">then</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;            <span class="keywordflow">do</span> k=1,lm</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;              k1 = k + kd</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;              <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                effrl(i,k1) = tbd%phy_f3d(i,k,2)</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                effri(i,k1) = tbd%phy_f3d(i,k,3)</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                effrr(i,k1) = tbd%phy_f3d(i,k,4)</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                effrs(i,k1) = tbd%phy_f3d(i,k,5)</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <span class="keywordflow">elseif</span> (model%imp_physics == 10) <span class="keywordflow">then</span>                                 <span class="comment">! MG microphys</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;          cldcov(1:im,1+kd:lm+kd) = tbd%phy_f3d(1:im,1:lm,1)</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;          <span class="keywordflow">if</span> (model%effr_in) <span class="keywordflow">then</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            <span class="keywordflow">do</span> k=1,lm</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;              k1 = k + kd</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;              <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                effrl(i,k1) = tbd%phy_f3d(i,k,2)</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                effri(i,k1) = tbd%phy_f3d(i,k,3)</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                effrr(i,k1) = tbd%phy_f3d(i,k,4)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                effrs(i,k1) = tbd%phy_f3d(i,k,5)</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <span class="keywordflow">elseif</span> (model%imp_physics == 11) <span class="keywordflow">then</span>                          <span class="comment">! GFDL MP</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;          cldcov(1:im,1+kd:lm+kd) = tracer1(1:im,1:lm,model%ntclamt)</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        <span class="keywordflow">else</span>                                                           <span class="comment">! neither of the other two cases</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;          cldcov = 0.0</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">!  --- add suspended convective cloud water to grid-scale cloud water</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">!      only for cloud fraction &amp; radiation computation</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">!      it is to enhance cloudiness due to suspended convec cloud water</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">!      for zhao/moorthi&#39;s (imp_phys=99) &amp;</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment">!          ferrier&#39;s (imp_phys=5) microphysics schemes</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="keywordflow">if</span> ((model%num_p3d == 4) .and. (model%npdf3d == 3)) <span class="keywordflow">then</span>       <span class="comment">! same as Model%imp_physics = 99</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;          <span class="keywordflow">do</span> k=1,lm</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;            k1 = k + kd</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;              deltaq(i,k1) = tbd%phy_f3d(i,k,5)</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;              cnvw(i,k1) = tbd%phy_f3d(i,k,6)</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;              cnvc(i,k1) = tbd%phy_f3d(i,k,7)</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <span class="keywordflow">elseif</span> ((model%npdf3d == 0) .and. (model%ncnvcld3d == 1)) <span class="keywordflow">then</span> <span class="comment">! same as MOdel%imp_physics=98</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;          <span class="keywordflow">do</span> k=1,lm</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;            k1 = k + kd</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;              deltaq(i,k1) = 0.0</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;              cnvw(i,k1) = tbd%phy_f3d(i,k,model%num_p3d+1)</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;              cnvc(i,k1) = 0.0</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        <span class="keywordflow">else</span>                                                           <span class="comment">! all the rest</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;          <span class="keywordflow">do</span> k=1,lmk</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;              deltaq(i,k) = 0.0</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;              cnvw(i,k) = 0.0</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;              cnvc(i,k) = 0.0</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;          <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            cldcov(i,lyb) = cldcov(i,lya)</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            deltaq(i,lyb) = deltaq(i,lya)</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;            cnvw(i,lyb) = cnvw(i,lya)</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            cnvc(i,lyb) = cnvc(i,lya)</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;          <span class="keywordflow">if</span> (model%effr_in) <span class="keywordflow">then</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;              effrl(i,lyb) = effrl(i,lya)</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;              effri(i,lyb) = effri(i,lya)</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;              effrr(i,lyb) = effrr(i,lya)</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;              effrs(i,lyb) = effrs(i,lya)</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        <span class="keywordflow">if</span> (model%imp_physics == 99) <span class="keywordflow">then</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;          ccnd(1:im,1:lmk,1) = ccnd(1:im,1:lmk,1) + cnvw(1:im,1:lmk)</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        <span class="keywordflow">if</span> (model%imp_physics == 99 .or. model%imp_physics == 10) <span class="keywordflow">then</span>           <span class="comment">! zhao/moorthi&#39;s prognostic cloud scheme</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                                         <span class="comment">! or unified cloud and/or with MG microphysics</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;          <span class="keywordflow">if</span> (model%uni_cld .and. ncld &gt;= 2) <span class="keywordflow">then</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;            <span class="keyword">call </span>progclduni (plyr, plvl, tlyr, tvly, ccnd, model%ncnd,  &amp; <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                             grid%xlat, grid%xlon, sfcprop%slmsk,       &amp;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                             im, lmk, lmp, cldcov,                      &amp;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                             effrl, effri, effrr, effrs, model%effr_in, &amp;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                             clouds, cldsa, mtopa, mbota)                 <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            <span class="keyword">call </span>progcld1 (plyr ,plvl, tlyr, tvly, qlyr, qstl, rhly,    &amp; <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                           ccnd(1:im,1:lmk,1), grid%xlat,grid%xlon,     &amp;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                           sfcprop%slmsk, im, lmk, lmp,                 &amp;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                           model%uni_cld, model%lmfshal,                &amp;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                           model%lmfdeep2, cldcov,                      &amp;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                           effrl, effri, effrr, effrs, model%effr_in,   &amp;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                           clouds, cldsa, mtopa, mbota)                   <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="keywordflow">elseif</span>(model%imp_physics == 98) <span class="keywordflow">then</span>      <span class="comment">! zhao/moorthi&#39;s prognostic cloud+pdfcld</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;          <span class="keyword">call </span>progcld3 (plyr, plvl, tlyr, tvly, qlyr, qstl, rhly,      &amp;    <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                         ccnd(1:im,1:lmk,1),                            &amp;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                         cnvw, cnvc, grid%xlat, grid%xlon,              &amp;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                         sfcprop%slmsk,im, lmk, lmp, deltaq,            &amp;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                         model%sup, model%kdt, me,                      &amp;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                         clouds, cldsa, mtopa, mbota)                      <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        <span class="keywordflow">elseif</span> (model%imp_physics == 11) <span class="keywordflow">then</span>           <span class="comment">! GFDL cloud scheme</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;          <span class="keywordflow">if</span> (.not.model%lgfdlmprad) <span class="keywordflow">then</span> </div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <span class="keyword">call </span>progcld4 (plyr, plvl, tlyr, tvly, qlyr, qstl, rhly,      &amp;    <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                           ccnd(1:im,1:lmk,1),                            &amp;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                           grid%xlat, grid%xlon, sfcprop%slmsk,           &amp;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                           cldcov, im, lmk, lmp,                          &amp;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                           clouds, cldsa, mtopa, mbota)                      <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            <span class="keyword">call </span>progclduni (plyr, plvl, tlyr, tvly, ccnd, model%ncnd,    &amp;    <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                            grid%xlat, grid%xlon, sfcprop%slmsk,          &amp;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                            im, lmk, lmp, cldcov,                         &amp;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                            effrl, effri, effrr, effrs, model%effr_in,    &amp;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                            clouds, cldsa, mtopa, mbota)                    <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;<span class="comment">!           call progcld4o (plyr, plvl, tlyr, tvly, qlyr, qstl, rhly,       &amp;    !  ---  inputs</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="comment">!                           tracer1, Grid%xlat, Grid%xlon, Sfcprop%slmsk,   &amp;</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="comment">!                           ntrac-1, Model%ntcw-1,Model%ntiw-1,Model%ntrw-1,&amp; </span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="comment">!                           Model%ntsw-1,Model%ntgl-1,Model%ntclamt-1,      &amp;</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">!                           im, lmk, lmp,                                   &amp;</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="comment">!                           clouds, cldsa, mtopa, mbota)                  !  ---  outputs</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;<span class="keywordflow">          endif</span> </div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;        <span class="keywordflow">elseif</span>(model%imp_physics == 8 .or. model%imp_physics == 6) <span class="keywordflow">then</span>            <span class="comment">! Thompson / WSM6 cloud micrphysics scheme </span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;          <span class="keywordflow">if</span> (model%kdt == 1) <span class="keywordflow">then</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;            tbd%phy_f3d(:,:,1) = 10.</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            tbd%phy_f3d(:,:,2) = 50.</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            tbd%phy_f3d(:,:,3) = 250.</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;          <span class="keyword">call </span>progcld5 (plyr,plvl,tlyr,qlyr,qstl,rhly,tracer1,   &amp;    <span class="comment">!  --- inputs </span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                         grid%xlat,grid%xlon,sfcprop%slmsk,       &amp;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                         ntrac-1, ntcw-1,ntiw-1,ntrw-1,           &amp; </div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                         ntsw-1,ntgl-1,                           &amp;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                         im, lmk, lmp, model%uni_cld,             &amp;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                         model%lmfshal,model%lmfdeep2,            &amp;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                         cldcov(:,1:lmk),tbd%phy_f3d(:,:,1),      &amp;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                         tbd%phy_f3d(:,:,2), tbd%phy_f3d(:,:,3),  &amp;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                         clouds,cldsa,mtopa,mbota)                     <span class="comment">!  --- outputs  </span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;              </div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="keywordflow">        endif</span>                            <span class="comment">! end if_imp_physics</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <span class="keywordflow">else</span>                               <span class="comment">! diagnostic cloud scheme</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;          cvt1(i) = 0.01 * cldprop%cvt(i)</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;          cvb1(i) = 0.01 * cldprop%cvb(i)</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;          vvel(1:im,k1) = 0.01 * statein%vvl(1:im,k)</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">lextop</a>) <span class="keywordflow">then</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;          vvel(1:im,lyb) = vvel(1:im,lya)</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">!  ---  compute diagnostic cloud related quantities</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <span class="keyword">call </span>diagcld1 (plyr, plvl, tlyr, rhly, vvel, cldprop%cv,  &amp;    <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                       cvt1, cvb1, grid%xlat, grid%xlon,          &amp;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                       sfcprop%slmsk, im, lmk, lmp,               &amp;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                       clouds, cldsa, mtopa, mbota)                    <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_ntcw</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">!  --- ...  start radiation calculations</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">!           remember to set heating rate unit to k/sec!</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="keywordflow">if</span> (model%lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keyword">call </span>setalb (sfcprop%slmsk, sfcprop%snowd, sfcprop%sncovr,&amp;    <span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                     sfcprop%snoalb, sfcprop%zorl, radtend%coszen,&amp;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                     tsfg, tsfa, sfcprop%hprim, sfcprop%alvsf,    &amp;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                     sfcprop%alnsf, sfcprop%alvwf, sfcprop%alnwf, &amp;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                     sfcprop%facsf, sfcprop%facwf, sfcprop%fice,  &amp;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                     sfcprop%tisfc, im,                           &amp;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                     sfcalb)                                           <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;        radtend%sfalb(:) = max(0.01, 0.5 * (sfcalb(:,2) + sfcalb(:,4)))</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        <span class="keywordflow">if</span> (nday &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">!     print *,&#39; in grrad : calling swrad&#39;</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;          <span class="keywordflow">if</span> (model%swhtr) <span class="keywordflow">then</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            <span class="keyword">call </span>swrad (plyr, plvl, tlyr, tlvl, qlyr, olyr,     &amp;      <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                        gasvmr, clouds, tbd%icsdsw, faersw,     &amp;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                        sfcalb, radtend%coszen, model%solcon,   &amp;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                        nday, idxday, im, lmk, lmp, model%lprnt,&amp;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                        htswc, diag%topfsw, radtend%sfcfsw,     &amp;      <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                        hsw0=htsw0, fdncmp=scmpsw)                     <span class="comment">! ---  optional</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            <span class="keyword">call </span>swrad (plyr, plvl, tlyr, tlvl, qlyr, olyr,     &amp;      <span class="comment">!  ---  inputs </span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                        gasvmr, clouds, tbd%icsdsw, faersw,     &amp;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                        sfcalb, radtend%coszen, model%solcon,   &amp;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                        nday, idxday, im, lmk, lmp, model%lprnt,&amp;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                        htswc, diag%topfsw, radtend%sfcfsw,     &amp;      <span class="comment">!  ---  outputs </span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                        fdncmp=scmpsw)                                 <span class="comment">! ---  optional </span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            k1 = k + kd</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            radtend%htrsw(:,k) = htswc(:,k1)</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;<span class="comment">! --- repopulate the points above levr</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;          <span class="keywordflow">if</span> (model%levr &lt; model%levs) <span class="keywordflow">then</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            <span class="keywordflow">do</span> k = lm,model%levs</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;              radtend%htrsw (:,k) = radtend%htrsw (:,lm)</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;          <span class="keywordflow">if</span> (model%swhtr) <span class="keywordflow">then</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;               k1 = k + kd</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;               radtend%swhc(1:im,k) = htsw0(1:im,k1)</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">! --- repopulate the points above levr</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;             <span class="keywordflow">if</span> (model%levr &lt; model%levs) <span class="keywordflow">then</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;               <span class="keywordflow">do</span> k = lm,model%levs</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                 radtend%swhc(1:im,k) = radtend%swhc(1:im,lm) </div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="keywordflow">               enddo</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="keywordflow">             endif</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">!  --- surface down and up spectral component fluxes</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;          <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            coupling%nirbmdi(i) = scmpsw(i)%nirbm</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            coupling%nirdfdi(i) = scmpsw(i)%nirdf</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;            coupling%visbmdi(i) = scmpsw(i)%visbm</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;            coupling%visdfdi(i) = scmpsw(i)%visdf</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;            coupling%nirbmui(i) = scmpsw(i)%nirbm * sfcalb(i,1)</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;            coupling%nirdfui(i) = scmpsw(i)%nirdf * sfcalb(i,2)</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;            coupling%visbmui(i) = scmpsw(i)%visbm * sfcalb(i,3)</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            coupling%visdfui(i) = scmpsw(i)%visdf * sfcalb(i,4)</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        <span class="keywordflow">else</span>                   <span class="comment">! if_nday_block</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;          radtend%htrsw(:,:) = 0.0</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;          radtend%sfcfsw = sfcfsw_type( 0.0, 0.0, 0.0, 0.0 )</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;          diag%topfsw    = topfsw_type( 0.0, 0.0, 0.0 )</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;          scmpsw         = cmpfsw_type( 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 )</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;          <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;            coupling%nirbmdi(i) = 0.0</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;            coupling%nirdfdi(i) = 0.0</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;            coupling%visbmdi(i) = 0.0</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;            coupling%visdfdi(i) = 0.0</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;            coupling%nirbmui(i) = 0.0</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;            coupling%nirdfui(i) = 0.0</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;            coupling%visbmui(i) = 0.0</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            coupling%visdfui(i) = 0.0</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;          <span class="keywordflow">if</span> (model%swhtr) <span class="keywordflow">then</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;            radtend%swhc(:,:) = 0</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="keywordflow">        endif</span>                  <span class="comment">! end_if_nday</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">! --- radiation fluxes for other physics processes</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;          coupling%sfcnsw(i) = radtend%sfcfsw(i)%dnfxc - radtend%sfcfsw(i)%upfxc</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;          coupling%sfcdsw(i) = radtend%sfcfsw(i)%dnfxc</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_lsswr</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;      <span class="keywordflow">if</span> (model%lslwr) <span class="keywordflow">then</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        <span class="keyword">call </span>setemis (grid%xlon, grid%xlat, sfcprop%slmsk,         &amp;        <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                      sfcprop%snowd, sfcprop%sncovr, sfcprop%zorl, &amp;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                      tsfg, tsfa, sfcprop%hprim, im,               &amp; </div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                      radtend%semis)                                              <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">!     print *,&#39; in grrad : calling lwrad&#39;</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;        <span class="keywordflow">if</span> (model%lwhtr) <span class="keywordflow">then</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;          <span class="keyword">call </span>lwrad (plyr, plvl, tlyr, tlvl, qlyr, olyr, gasvmr,  &amp;        <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                      clouds, tbd%icsdlw, faerlw, radtend%semis,   &amp;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                      tsfg, im, lmk, lmp, model%lprnt,             &amp;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                      htlwc, diag%topflw, radtend%sfcflw,          &amp;        <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                      hlw0=htlw0)                                           <span class="comment">!  ---  optional</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;          <span class="keyword">call </span>lwrad (plyr, plvl, tlyr, tlvl, qlyr, olyr, gasvmr,  &amp;        <span class="comment">!  ---  inputs</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                      clouds, tbd%icsdlw, faerlw, radtend%semis,   &amp;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                      tsfg, im, lmk, lmp, model%lprnt,             &amp;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                      htlwc, diag%topflw, radtend%sfcflw)                   <span class="comment">!  ---  outputs</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        radtend%tsflw (:) = tsfa(:)</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            radtend%htrlw(1:im,k) = htlwc(1:im,k1)</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">! --- repopulate the points above levr</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <span class="keywordflow">if</span> (model%levr &lt; model%levs) <span class="keywordflow">then</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;          <span class="keywordflow">do</span> k = lm,model%levs</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;            radtend%htrlw (1:im,k) = radtend%htrlw (1:im,lm)</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">if</span> (model%lwhtr) <span class="keywordflow">then</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            k1 = k + kd</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;            radtend%lwhc(1:im,k) = htlw0(1:im,k1)</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">! --- repopulate the points above levr</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;          <span class="keywordflow">if</span> (model%levr &lt; model%levs) <span class="keywordflow">then</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;            <span class="keywordflow">do</span> k = lm,model%levs</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;              radtend%lwhc(1:im,k) = radtend%lwhc(1:im,lm) </div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="comment">! --- radiation fluxes for other physics processes</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        coupling%sfcdlw(:) = radtend%sfcflw(:)%dnfxc</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_lslwr</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment">!  --- ...  collect the fluxr data for wrtsfc</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      <span class="keywordflow">if</span> (model%lssav) <span class="keywordflow">then</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <span class="keywordflow">if</span> (model%lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;          <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;            diag%fluxr(i,34) = diag%fluxr(i,34) + model%fhswr*aerodp(i,1)  <span class="comment">! total aod at 550nm</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;            diag%fluxr(i,35) = diag%fluxr(i,35) + model%fhswr*aerodp(i,2)  <span class="comment">! DU aod at 550nm</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;            diag%fluxr(i,36) = diag%fluxr(i,36) + model%fhswr*aerodp(i,3)  <span class="comment">! BC aod at 550nm</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;            diag%fluxr(i,37) = diag%fluxr(i,37) + model%fhswr*aerodp(i,4)  <span class="comment">! OC aod at 550nm</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;            diag%fluxr(i,38) = diag%fluxr(i,38) + model%fhswr*aerodp(i,5)  <span class="comment">! SU aod at 550nm</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;            diag%fluxr(i,39) = diag%fluxr(i,39) + model%fhswr*aerodp(i,6)  <span class="comment">! SS aod at 550nm</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="comment">!  ---  save lw toa and sfc fluxes</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <span class="keywordflow">if</span> (model%lslwr) <span class="keywordflow">then</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="comment">!  ---  lw total-sky fluxes</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;          <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;            diag%fluxr(i,1 ) = diag%fluxr(i,1 ) + model%fhlwr *    diag%topflw(i)%upfxc   <span class="comment">! total sky top lw up</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;            diag%fluxr(i,19) = diag%fluxr(i,19) + model%fhlwr * radtend%sfcflw(i)%dnfxc   <span class="comment">! total sky sfc lw dn</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;            diag%fluxr(i,20) = diag%fluxr(i,20) + model%fhlwr * radtend%sfcflw(i)%upfxc   <span class="comment">! total sky sfc lw up</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">!  ---  lw clear-sky fluxes</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;            diag%fluxr(i,28) = diag%fluxr(i,28) + model%fhlwr *    diag%topflw(i)%upfx0   <span class="comment">! clear sky top lw up</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;            diag%fluxr(i,30) = diag%fluxr(i,30) + model%fhlwr * radtend%sfcflw(i)%dnfx0   <span class="comment">! clear sky sfc lw dn</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            diag%fluxr(i,33) = diag%fluxr(i,33) + model%fhlwr * radtend%sfcflw(i)%upfx0   <span class="comment">! clear sky sfc lw up</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;<span class="comment">!  ---  save sw toa and sfc fluxes with proper diurnal sw wgt. coszen=mean cosz over daylight</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="comment">!       part of sw calling interval, while coszdg= mean cosz over entire interval</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        <span class="keywordflow">if</span> (model%lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;            <span class="keywordflow">if</span> (radtend%coszen(i) &gt; 0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="comment">!  ---                                  sw total-sky fluxes</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">!                                       -------------------</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;              tem0d = model%fhswr * radtend%coszdg(i)  / radtend%coszen(i)</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;              diag%fluxr(i,2 ) = diag%fluxr(i,2)  +    diag%topfsw(i)%upfxc * tem0d  <span class="comment">! total sky top sw up</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;              diag%fluxr(i,3 ) = diag%fluxr(i,3)  + radtend%sfcfsw(i)%upfxc * tem0d  <span class="comment">! total sky sfc sw up</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;              diag%fluxr(i,4 ) = diag%fluxr(i,4)  + radtend%sfcfsw(i)%dnfxc * tem0d  <span class="comment">! total sky sfc sw dn</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">!  ---                                  sw uv-b fluxes</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">!                                       --------------</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;              diag%fluxr(i,21) = diag%fluxr(i,21) + scmpsw(i)%uvbfc * tem0d          <span class="comment">! total sky uv-b sw dn</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;              diag%fluxr(i,22) = diag%fluxr(i,22) + scmpsw(i)%uvbf0 * tem0d          <span class="comment">! clear sky uv-b sw dn</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">!  ---                                  sw toa incoming fluxes</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">!                                       ----------------------</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;              diag%fluxr(i,23) = diag%fluxr(i,23) + diag%topfsw(i)%dnfxc * tem0d     <span class="comment">! top sw dn</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">!  ---                                  sw sfc flux components</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">!                                       ----------------------</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;              diag%fluxr(i,24) = diag%fluxr(i,24) + scmpsw(i)%visbm * tem0d          <span class="comment">! uv/vis beam sw dn</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;              diag%fluxr(i,25) = diag%fluxr(i,25) + scmpsw(i)%visdf * tem0d          <span class="comment">! uv/vis diff sw dn</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;              diag%fluxr(i,26) = diag%fluxr(i,26) + scmpsw(i)%nirbm * tem0d          <span class="comment">! nir beam sw dn</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;              diag%fluxr(i,27) = diag%fluxr(i,27) + scmpsw(i)%nirdf * tem0d          <span class="comment">! nir diff sw dn</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">!  ---                                  sw clear-sky fluxes</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">!                                       -------------------</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;              diag%fluxr(i,29) = diag%fluxr(i,29) + diag%topfsw(i)%upfx0 * tem0d  <span class="comment">! clear sky top sw up</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;              diag%fluxr(i,31) = diag%fluxr(i,31) + radtend%sfcfsw(i)%upfx0 * tem0d  <span class="comment">! clear sky sfc sw up</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;              diag%fluxr(i,32) = diag%fluxr(i,32) + radtend%sfcfsw(i)%dnfx0 * tem0d  <span class="comment">! clear sky sfc sw dn</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">!  ---  save total and boundary layer clouds</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        <span class="keywordflow">if</span> (model%lsswr .or. model%lslwr) <span class="keywordflow">then</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;          <span class="keywordflow">do</span> i=1,im</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;            diag%fluxr(i,17) = diag%fluxr(i,17) + raddt * cldsa(i,4)</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;            diag%fluxr(i,18) = diag%fluxr(i,18) + raddt * cldsa(i,5)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">!  ---  save cld frac,toplyr,botlyr and top temp, note that the order</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">!       of h,m,l cloud is reversed for the fluxr output.</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">!  ---  save interface pressure (pa) of top/bot</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;          <span class="keywordflow">do</span> j = 1, 3</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;              tem0d = raddt * cldsa(i,j)</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;              itop  = mtopa(i,j) - kd</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;              ibtc  = mbota(i,j) - kd</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;              diag%fluxr(i, 8-j) = diag%fluxr(i, 8-j) + tem0d</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;              diag%fluxr(i,11-j) = diag%fluxr(i,11-j) + tem0d * statein%prsi(i,itop+kt)</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;              diag%fluxr(i,14-j) = diag%fluxr(i,14-j) + tem0d * statein%prsi(i,ibtc+kb)</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;              diag%fluxr(i,17-j) = diag%fluxr(i,17-j) + tem0d * statein%tgrs(i,itop)</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment">!       Anning adds optical depth and emissivity output</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;              tem1 = 0.</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;              tem2 = 0.</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;              <span class="keywordflow">do</span> k=ibtc+kb,itop+kt</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                 tem1 = tem1 + clouds(i,k,10)</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                 tem2 = tem2 + clouds(i,k,11)</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="keywordflow">              end do</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;              diag%fluxr(i,43-j) = diag%fluxr(i,43-j) + tem0d * tem1</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;              diag%fluxr(i,46-j) = diag%fluxr(i,46-j) + tem0d * (1.0-exp(-tem2))</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">!       if (.not. Model%uni_cld) then</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        <span class="keywordflow">if</span> (model%lgocart .or. model%ldiag3d) <span class="keywordflow">then</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;            k1 = k + kd</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            coupling%cldcovi(1:im,k) = clouds(1:im,k1,1)</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_lssav</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">!........................................</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a">gfs_radiation_driver</a></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">!----------------------------------------</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="keyword">      end module </span><a class="code" href="namespacemodule__radiation__driver.html">module_radiation_driver</a> <span class="comment">!</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">!========================================!</span></div><div class="ttc" id="group__module__radiation__driver_html_ga0b0bf0fa8723b80d0891ec3327d187d7"><div class="ttname"><a href="group__module__radiation__driver.html#ga0b0bf0fa8723b80d0891ec3327d187d7">module_radiation_driver::epsq</a></div><div class="ttdeci">real(kind=kind_phys) epsq</div><div class="ttdoc">EPSQ=1.0e-12. </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00367">GFS_radiation_driver.F90:367</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_gafdc2a7e1dbfb075ac33a2388564d9428"><div class="ttname"><a href="group__module__radiation__driver.html#gafdc2a7e1dbfb075ac33a2388564d9428">module_radiation_driver::qmin</a></div><div class="ttdeci">real(kind=kind_phys) qmin</div><div class="ttdoc">lower limit of saturation vapor pressure (=1.0e-10) </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00361">GFS_radiation_driver.F90:361</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga9c5872d3bd177315e79977d40245a99a"><div class="ttname"><a href="group__module__radiation__driver.html#ga9c5872d3bd177315e79977d40245a99a">module_radiation_driver::gfs_radiation_driver</a></div><div class="ttdeci">subroutine, public gfs_radiation_driver(Model, Statein, Stateout, Sfcprop, Coupling, Grid, Tbd, Cldprop, Radtend, Diag)</div><div class="ttdoc">This subroutine is the driver of main radiation calculations. It sets up column profiles, such as pressure, temperature, moisture, gases, clouds, aerosols, etc., as well as surface radiative characteristics, such as surface albedo, and emissivity. The call of this subroutine is placed inside both the time advancing loop and the horizontal grid loop. </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l01015">GFS_radiation_driver.F90:1015</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_gab671cb80142c71dab5f41f01ccdcc088"><div class="ttname"><a href="group__module__radiation__driver.html#gab671cb80142c71dab5f41f01ccdcc088">module_radiation_driver::qme5</a></div><div class="ttdeci">real(kind=kind_phys) qme5</div><div class="ttdoc">lower limit of specific humidity (=1.0e-7) </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00363">GFS_radiation_driver.F90:363</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga3fc43ca0d2c5f69a380ddb4f0926ecc7"><div class="ttname"><a href="group__module__radiation__driver.html#ga3fc43ca0d2c5f69a380ddb4f0926ecc7">module_radiation_driver::prsmin</a></div><div class="ttdeci">real, parameter prsmin</div><div class="ttdoc">lower limit of toa pressure value in mb </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00373">GFS_radiation_driver.F90:373</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga6eb268f296c77047f389ed6fac5f95be"><div class="ttname"><a href="group__module__radiation__driver.html#ga6eb268f296c77047f389ed6fac5f95be">module_radiation_driver::month0</a></div><div class="ttdeci">integer month0</div><div class="ttdoc">new data input control variables (set/reset in subroutines radinit/radupdate): </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00380">GFS_radiation_driver.F90:380</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__sfcprop__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__sfcprop__type.html">gfs_typedefs::gfs_sfcprop_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00140">GFS_typedefs.F90:140</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_gaf6e0e1ef2ebb78f57c897ebaf633edd2"><div class="ttname"><a href="group__module__radiation__driver.html#gaf6e0e1ef2ebb78f57c897ebaf633edd2">module_radiation_driver::loz1st</a></div><div class="ttdeci">logical loz1st</div><div class="ttdoc">control flag for the first time of reading climatological ozone data (set/reset in subroutines radini...</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00385">GFS_radiation_driver.F90:385</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga3d4ef1d77b7d7ef09fafcb4413e1cbf2"><div class="ttname"><a href="group__module__radiation__driver.html#ga3d4ef1d77b7d7ef09fafcb4413e1cbf2">module_radiation_driver::radinit</a></div><div class="ttdeci">subroutine, public radinit(si, NLAY, imp_physics, me)</div><div class="ttdoc">This subroutine initialize a model&amp;#39;s radiation process through calling of specific initialization sub...</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00417">GFS_radiation_driver.F90:417</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__diag__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__diag__type.html">gfs_typedefs::gfs_diag_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00772">GFS_typedefs.F90:772</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_gac4baf8ff048aaa5b85d03cc42c579c7b"><div class="ttname"><a href="group__module__radiation__driver.html#gac4baf8ff048aaa5b85d03cc42c579c7b">module_radiation_driver::monthd</a></div><div class="ttdeci">integer monthd</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00380">GFS_radiation_driver.F90:380</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__radtend__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__radtend__type.html">gfs_typedefs::gfs_radtend_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00729">GFS_typedefs.F90:729</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__coupling__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__coupling__type.html">gfs_typedefs::gfs_coupling_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00222">GFS_typedefs.F90:222</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__control__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__control__type.html">gfs_typedefs::gfs_control_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00324">GFS_typedefs.F90:324</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a70a36595385cf1f5794f9c5859e52ab6"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a70a36595385cf1f5794f9c5859e52ab6">module_radiation_driver::vtagrad</a></div><div class="ttdeci">character(40), parameter vtagrad</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00353">GFS_radiation_driver.F90:353</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__cldprop__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__cldprop__type.html">gfs_typedefs::gfs_cldprop_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00712">GFS_typedefs.F90:712</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__statein__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__statein__type.html">gfs_typedefs::gfs_statein_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00092">GFS_typedefs.F90:92</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_gaab2535e9906afd709124056f4ca1e470"><div class="ttname"><a href="group__module__radiation__driver.html#gaab2535e9906afd709124056f4ca1e470">module_radiation_driver::ltp</a></div><div class="ttdeci">integer, parameter ltp</div><div class="ttdoc">optional extra top layer on top of low ceiling models   LTP=0: no extra top layer ...</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00389">GFS_radiation_driver.F90:389</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__grid__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__grid__type.html">gfs_typedefs::gfs_grid_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00640">GFS_typedefs.F90:640</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__stateout__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__stateout__type.html">gfs_typedefs::gfs_stateout_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00123">GFS_typedefs.F90:123</a></div></div>
<div class="ttc" id="structgfs__typedefs_1_1gfs__tbd__type_html"><div class="ttname"><a href="structgfs__typedefs_1_1gfs__tbd__type.html">gfs_typedefs::gfs_tbd_type</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00671">GFS_typedefs.F90:671</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga28280ee9ea8ee0d183ab9d541a31b718"><div class="ttname"><a href="group__module__radiation__driver.html#ga28280ee9ea8ee0d183ab9d541a31b718">module_radiation_driver::radupdate</a></div><div class="ttdeci">subroutine, public radupdate(idate, jdate, deltsw, deltim, lsswr, me, slag, sdec, cdec, solcon)</div><div class="ttdoc">This subroutine checks and updates time sensitive data used by radiation computations. This subroutine needs to be placed inside the time advancement loop but outside of the horizontal grid loop. It is invoked at radiation calling frequncy but before any actual radiative transfer computations. </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00667">GFS_radiation_driver.F90:667</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga4916e37c472b2f824b6f566ff67200cd"><div class="ttname"><a href="group__module__radiation__driver.html#ga4916e37c472b2f824b6f566ff67200cd">module_radiation_driver::qme6</a></div><div class="ttdeci">real(kind=kind_phys) qme6</div><div class="ttdoc">lower limit of specific humidity (=1.0e-7) </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00365">GFS_radiation_driver.F90:365</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga9ee6a89464bf206cc07ea30d7eeaaeb8"><div class="ttname"><a href="group__module__radiation__driver.html#ga9ee6a89464bf206cc07ea30d7eeaaeb8">module_radiation_driver::itsfc</a></div><div class="ttdeci">integer itsfc</div><div class="ttdoc">control flag for LW surface temperature at air/ground interface (default=0, the value will be set in ...</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00377">GFS_radiation_driver.F90:377</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_gad27b36d0186c8147fe839eb5c268d157"><div class="ttname"><a href="group__module__radiation__driver.html#gad27b36d0186c8147fe839eb5c268d157">module_radiation_driver::lextop</a></div><div class="ttdeci">logical, parameter lextop</div><div class="ttdoc">control flag for extra top layer </div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00393">GFS_radiation_driver.F90:393</a></div></div>
<div class="ttc" id="group__module__radiation__driver_html_ga4d755de48d0aa83f337a2a907ac7d8a2"><div class="ttname"><a href="group__module__radiation__driver.html#ga4d755de48d0aa83f337a2a907ac7d8a2">module_radiation_driver::iyear0</a></div><div class="ttdeci">integer iyear0</div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00380">GFS_radiation_driver.F90:380</a></div></div>
<div class="ttc" id="namespacegfs__typedefs_html"><div class="ttname"><a href="namespacegfs__typedefs.html">gfs_typedefs</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__typedefs_8_f90_source.html#l00001">GFS_typedefs.F90:1</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html"><div class="ttname"><a href="namespacemodule__radiation__driver.html">module_radiation_driver</a></div><div class="ttdef"><b>Definition:</b> <a href="_g_f_s__radiation__driver_8_f90_source.html#l00306">GFS_radiation_driver.F90:306</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2961c5a6060afe1eafbb56d6f69a970f.html">GFS_layer</a></li><li class="navelem"><a class="el" href="_g_f_s__radiation__driver_8_f90.html">GFS_radiation_driver.F90</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
