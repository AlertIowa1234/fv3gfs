<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GFS Physics Documentation: Scale-Aware Mass-Flux Shallow Convection</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ccpp_dox_extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ncep.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GFS Physics Documentation
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group___s_a_m_f__shal.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Scale-Aware Mass-Flux Shallow Convection</div>  </div>
</div><!--header-->
<div class="contents">

<p>The scale-aware mass-flux shallow (SAMF_shal) convection scheme is an updated version of the previous mass-flux shallow convection scheme with scale and aerosol awareness and parameterizes the effect of shallow convection on the environment. The SAMF_shal scheme is similar to the SAMF deep convection scheme but with a few key differences. First, no quasi-equilibrium assumption is used for any grid size and the shallow cloud base mass flux is parameterized using a mean updraft velocity. Further, there are no convective downdrafts, the entrainment rate is greater than for deep convection, and the shallow convection is limited to not extend over the level where \(p=0.7p_{sfc}\). The paramerization of scale and aerosol awareness follows that of the SAMF deep convection scheme.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The previous version of the shallow convection scheme (shalcnv.f) is described in Han and Pan (2011) <a class="el" href="citelist.html#CITEREF_han_and_pan_2011">[24]</a> and differences between the shallow and deep convection schemes are presented in Han and Pan (2011) <a class="el" href="citelist.html#CITEREF_han_and_pan_2011">[24]</a> and Han et al. (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> . Details of scale- and aerosol-aware parameterizations are described in Han et al. (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> .</p>
<h1><a class="anchor" id="diagram"></a>
Calling Hierarchy Diagram</h1>
<div class="image">
<img src="Shallow_SAS_Flowchart.png" alt="Shallow_SAS_Flowchart.png" width="20cm"/>
<div class="caption">
Flowchart for scale-aware mass flux shallow convection scheme</div></div>
 <h1><a class="anchor" id="intraphysics"></a>
Intraphysics Communication</h1>
<p>This space is reserved for a description of how this scheme uses information from other scheme types and/or how information calculated in this scheme is used in other scheme types. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:samfshalcnv_8f"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="samfshalcnv_8f.html">samfshalcnv.f</a></td></tr>
<tr class="memdesc:samfshalcnv_8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains the entire SAMF shallow convection scheme. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8dbd74881cc19752c56c4fc49512e44c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___s_a_m_f__shal.html#ga8dbd74881cc19752c56c4fc49512e44c">samfshalcnv</a> (im, ix, km, delt, delp, prslp, psp, phil, ql,</td></tr>
<tr class="memdesc:ga8dbd74881cc19752c56c4fc49512e44c"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine contains the entirety of the SAMF shallow convection scheme.  <a href="#ga8dbd74881cc19752c56c4fc49512e44c">More...</a><br /></td></tr>
<tr class="separator:ga8dbd74881cc19752c56c4fc49512e44c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ga8dbd74881cc19752c56c4fc49512e44c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8dbd74881cc19752c56c4fc49512e44c">&#9670;&nbsp;</a></span>samfshalcnv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine samfshalcnv </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>im</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>ix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>km</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=kind_phys)&#160;</td>
          <td class="paramname"><em>delt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=kind_phys), dimension(ix,km)&#160;</td>
          <td class="paramname"><em>delp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=kind_phys), dimension(ix,km)&#160;</td>
          <td class="paramname"><em>prslp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=kind_phys), dimension(im)&#160;</td>
          <td class="paramname"><em>psp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>phil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ql</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This routine follows the <a class="el" href="group___s_a_m_f.html">Scale-Aware Mass-Flux Deep Convection</a> deep scheme quite closely, although it can be interpreted as only having the "static" and "feedback" control portions, since the "dynamic" control is not necessary to find the cloud base mass flux. The algorithm is simplified from SAMF deep convection by excluding convective downdrafts and being confined to operate below \(p=0.7p_{sfc}\). Also, entrainment is both simpler and stronger in magnitude compared to the deep scheme.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">im</td><td>number of used points </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ix</td><td>horizontal dimension </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">km</td><td>vertical layer dimension </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">jcap</td><td>number of spectral wave trancation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">delt</td><td>physics time step in seconds </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">delp</td><td>pressure difference between level k and k+1 (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">prslp</td><td>mean layer presure (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">psp</td><td>surface pressure (Pa) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phil</td><td>layer geopotential ( \(m^s/s^2\)) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ql</td><td>cloud water or ice (kg/kg) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">q1</td><td>updated tracers (kg/kg) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">t1</td><td>updated temperature (K) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">u1</td><td>updated zonal wind ( \(m s^{-1}\)) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v1</td><td>updated meridional wind ( \(m s^{-1}\)) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rn</td><td>convective rain (m) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">kbot</td><td>index for cloud base </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ktop</td><td>index for cloud top </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">kcnv</td><td>flag to denote deep convection (0=no, 1=yes) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">islimsk</td><td>sea/land/ice mask (=0/1/2) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dot</td><td>layer mean vertical velocity (Pa/s) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ncloud</td><td>number of cloud species </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hpbl</td><td>PBL height (m) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">heat</td><td>surface sensible heat flux (K m/s) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">evap</td><td>surface latent heat flux (kg/kg m/s) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ud_mf</td><td>updraft mass flux multiplied by time step ( \(kg/m^2\)) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dt_mf</td><td>ud_mf at cloud top ( \(kg/m^2\)) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cnvw</td><td>convective cloud water (kg/kg) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cnvc</td><td>convective cloud cover (unitless) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">clam</td><td>coefficient for entrainment rate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">c0s</td><td>convective rain conversion parameter (1/m) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">c1</td><td>conversion parameter of detrainment from liquid water into grid-scale cloud water (1/m) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pgcon</td><td>reduction factor in momentum transport due to convection induced pressure gradient force </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">asolfac</td><td>aerosol-aware parameter inversely proportional to CCN number concentraion</td></tr>
  </table>
  </dd>
</dl>
<h1><a class="anchor" id="general"></a>
General Algorithm</h1>
<ol type="1">
<li>Compute preliminary quantities needed for the static and feedback control portions of the algorithm.</li>
<li>Perform calculations related to the updraft of the entraining/detraining cloud model ("static control").</li>
<li>The cloud base mass flux is obtained using the cumulus updraft velocity averaged ove the whole cloud depth.</li>
<li>Calculate the tendencies of the state variables (per unit cloud base mass flux) and the cloud base mass flux.</li>
<li>For the "feedback control", calculate updated values of the state variables by multiplying the cloud base mass flux and the tendencies calculated per unit cloud base mass flux from the static control. </li>
</ol>
<h1><a class="anchor" id="detailed"></a>
Detailed Algorithm</h1>
<h2>Compute preliminary quantities needed for the static and feedback control portions of the algorithm.</h2>
<ul>
<li>Convert input pressure terms to centibar units.</li>
<li>Initialize column-integrated and other single-value-per-column variable arrays.</li>
<li>Return to the calling routine if deep convection is present or the surface buoyancy flux is negative.</li>
<li>determine aerosol-aware rain conversion parameter over land</li>
<li>determine rain conversion parameter above the freezing level which exponentially decreases with decreasing temperature from Han et al.'s (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> equation 8.</li>
<li>Initialize convective cloud water and cloud cover to zero.</li>
<li>Initialize updraft mass fluxes to zero.</li>
<li>Determine maximum indices for the parcel starting point (kbm) and cloud top (kmax).</li>
<li>Calculate hydrostatic height at layer centers assuming a flat surface (no terrain) from the geopotential.</li>
<li>Calculate interface height and the entrainment rate as an inverse function of height.</li>
<li>Find the index for the PBL top using the PBL height; enforce that it is lower than the maximum parcel starting level.</li>
<li>Convert prsl from centibar to millibar, set normalized mass flux to 1, cloud properties to 0, and save model state variables (after advection/turbulence).</li>
<li>Calculate saturation specific humidity and enforce minimum moisture values.</li>
<li>Calculate moist static energy (heo) and saturation moist static energy (heso).</li>
</ul>
<h2>Perform calculations related to the updraft of the entraining/detraining cloud model ("static control").</h2>
<ul>
<li>Search in the PBL for the level of maximum moist static energy to start the ascending parcel.</li>
<li>Calculate the temperature, water vapor mixing ratio, and pressure at interface levels.</li>
<li>Recalculate saturation specific humidity, moist static energy, saturation moist static energy, and horizontal momentum on interface levels. Enforce minimum specific humidity.</li>
<li>Search below the index "kbm" for the level of free convection (LFC) where the condition \(h_b &gt; h^*\) is first met, where \(h_b, h^*\) are the state moist static energy at the parcel's starting level and saturation moist static energy, respectively. Set "kbcon" to the index of the LFC.</li>
<li>If no LFC, return to the calling routine without modifying state variables.</li>
<li>Determine the vertical pressure velocity at the LFC. After Han and Pan (2011) <a class="el" href="citelist.html#CITEREF_han_and_pan_2011">[24]</a> , determine the maximum pressure thickness between a parcel's starting level and the LFC. If a parcel doesn't reach the LFC within the critical thickness, then the convective inhibition is deemed too great for convection to be triggered, and the subroutine returns to the calling routine without modifying the state variables.</li>
<li>The updraft detrainment rate is set constant and equal to the entrainment rate at cloud base.</li>
<li>Calculate the normalized mass flux for subcloud and in-cloud layers according to Pan and Wu (1995) <a class="el" href="citelist.html#CITEREF_pan_and_wu_1995">[48]</a> equation 1: <p class="formulaDsp">
\[ \frac{1}{\eta}\frac{\partial \eta}{\partial z} = \lambda_e - \lambda_d \]
</p>
 where \(\eta\) is the normalized mass flux, \(\lambda_e\) is the entrainment rate and \(\lambda_d\) is the detrainment rate. The normalized mass flux increases upward below the cloud base and decreases upward above.</li>
<li>Set cloud properties equal to the state variables at updraft starting level (kb).</li>
<li>Calculate the cloud properties as a parcel ascends, modified by entrainment and detrainment. Discretization follows Appendix B of Grell (1993) <a class="el" href="citelist.html#CITEREF_grell_1993">[22]</a> . Following Han and Pan (2006) <a class="el" href="citelist.html#CITEREF_han_and_pan_2006">[23]</a>, the convective momentum transport is reduced by the convection-induced pressure gradient force by the constant "pgcon", currently set to 0.55 after Zhang and Wu (2003) <a class="el" href="citelist.html#CITEREF_zhang_and_wu_2003">[65]</a> .</li>
<li>With entrainment, recalculate the LFC as the first level where buoyancy is positive. The difference in pressure levels between LFCs calculated with/without entrainment must be less than a threshold (currently 25 hPa). Otherwise, convection is inhibited and the scheme returns to the calling routine without modifying the state variables. This is the subcloud dryness trigger modification discussed in Han and Pan (2011) <a class="el" href="citelist.html#CITEREF_han_and_pan_2011">[24]</a>.</li>
<li>Calculate additional trigger condition of the convective inhibition (CIN) according to Han et al.'s (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> equation 13.</li>
<li>Turn off convection if the CIN is less than a critical value (cinacr) which is inversely proportional to the large-scale vertical velocity.</li>
<li>Calculate the cloud top as the first level where parcel buoyancy becomes negative; the maximum possible value is at \(p=0.7p_{sfc}\).</li>
<li>Calculate the maximum value of the cloud base mass flux using the CFL-criterion-based formula of Han and Pan (2011) <a class="el" href="citelist.html#CITEREF_han_and_pan_2011">[24]</a>, equation 7.</li>
<li>Set cloud moisture property equal to the enviromental moisture at updraft starting level (kb).</li>
<li>Calculate the moisture content of the entraining/detraining parcel (qcko) and the value it would have if just saturated (qrch), according to equation A.14 in Grell (1993) <a class="el" href="citelist.html#CITEREF_grell_1993">[22]</a> . Their difference is the amount of convective cloud water (qlk = rain + condensate). Determine the portion of convective cloud water that remains suspended and the portion that is converted into convective precipitation (pwo). Calculate and save the negative cloud work function (aa1) due to water loading. Above the level of minimum moist static energy, some of the cloud water is detrained into the grid-scale cloud water from every cloud layer with a rate of 0.0005 \(m^{-1}\) (dellal).</li>
<li>Calculate the cloud work function according to Pan and Wu (1995) <a class="el" href="citelist.html#CITEREF_pan_and_wu_1995">[48]</a> equation 4: <p class="formulaDsp">
\[ A_u=\int_{z_0}^{z_t}\frac{g}{c_pT(z)}\frac{\eta}{1 + \gamma}[h(z)-h^*(z)]dz \]
</p>
 (discretized according to Grell (1993) <a class="el" href="citelist.html#CITEREF_grell_1993">[22]</a> equation B.10 using B.2 and B.3 of Arakawa and Schubert (1974) <a class="el" href="citelist.html#CITEREF_arakawa_and_schubert_1974">[4]</a> and assuming \(\eta=1\)) where \(A_u\) is the updraft cloud work function, \(z_0\) and \(z_t\) are cloud base and cloud top, respectively, \(\gamma = \frac{L}{c_p}\left(\frac{\partial \overline{q_s}}{\partial T}\right)_p\) and other quantities are previously defined.</li>
<li>If the updraft cloud work function is negative, convection does not occur, and the scheme returns to the calling routine.</li>
<li>Continue calculating the cloud work function past the point of neutral buoyancy to represent overshooting according to Han and Pan (2011) <a class="el" href="citelist.html#CITEREF_han_and_pan_2011">[24]</a> . Convective overshooting stops when \( cA_u &lt; 0\) where \(c\) is currently 10%, or when 10% of the updraft cloud work function has been consumed by the stable buoyancy force. Overshooting is also limited to the level where \(p=0.7p_{sfc}\).</li>
<li>For the overshooting convection, calculate the moisture content of the entraining/detraining parcel as before. Partition convective cloud water and precipitation and detrain convective cloud water in the overshooting layers.</li>
<li>Calculate updraft velocity square(wu2) according to Han et al.'s (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> equation 7.</li>
<li>Calculate the mean updraft velocity within the cloud (wc).</li>
<li>=&gt; Separate the total updraft cloud water at cloud top into vapor and condensate.</li>
</ul>
<h2>Calculate the tendencies of the state variables (per unit cloud base mass flux) and the cloud base mass flux.</h2>
<ul>
<li>Calculate the change in moist static energy, moisture mixing ratio, and horizontal winds per unit cloud base mass flux for all layers below cloud top from equations B.14 and B.15 from Grell (1993) <a class="el" href="citelist.html#CITEREF_grell_1993">[22]</a>, and for the cloud top from B.16 and B.17.</li>
<li>Following Bechtold et al. (2008) <a class="el" href="citelist.html#CITEREF_bechtold_et_al_2008">[7]</a>, calculate the convective turnover time using the mean updraft velocity (wc) and the cloud depth. It is also proportional to the grid size (gdx).</li>
<li>Calculate advective time scale (tauadv) using a mean cloud layer wind speed.</li>
<li>From Han et al.'s (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> equation 6, calculate cloud base mass flux as a function of the mean updraft velcoity. As discussed in Han et al. (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> , when dtconv is larger than tauadv, the convective mixing is not fully conducted before the cumulus cloud is advected out of the grid cell. In this case, therefore, the cloud base mass flux is further reduced in proportion to the ratio of tauadv to dtconv.</li>
<li>For scale-aware parameterization, the updraft fraction (sigmagfm) is first computed as a function of the lateral entrainment rate at cloud base (see Han et al.'s (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> equation 4 and 5), following the study by Grell and Freitas (2014) <a class="el" href="citelist.html#CITEREF_grell_and_freitus_2014">[1]</a>.</li>
<li>Then, calculate the reduction factor (scaldfunc) of the vertical convective eddy transport of mass flux as a function of updraft fraction from the studies by Arakawa and Wu (2013) <a class="el" href="citelist.html#CITEREF_arakawa_and_wu_2013">[2]</a> (also see Han et al.'s (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> equation 1 and 2). The final cloud base mass flux with scale-aware parameterization is obtained from the mass flux when sigmagfm &lt;&lt; 1, multiplied by the reduction factor (Han et al.'s (2017) <a class="el" href="citelist.html#CITEREF_han_et_al_2017">[34]</a> equation 2).</li>
</ul>
<h2>For the "feedback control", calculate updated values of the state variables by multiplying the cloud base mass flux and the tendencies calculated per unit cloud base mass flux from the static control.</h2>
<ul>
<li>Recalculate saturation specific humidity.</li>
<li>Calculate the temperature tendency from the moist static energy and specific humidity tendencies.</li>
<li>Update the temperature, specific humidity, and horiztonal wind state variables by multiplying the cloud base mass flux-normalized tendencies by the cloud base mass flux.</li>
<li>Accumulate column-integrated tendencies.</li>
<li>Recalculate saturation specific humidity using the updated temperature.</li>
<li>Add up column-integrated convective precipitation by multiplying the normalized value by the cloud base mass flux.</li>
<li>Determine the evaporation of the convective precipitation and update the integrated convective precipitation.</li>
<li>Update state temperature and moisture to account for evaporation of convective precipitation.</li>
<li>Update column-integrated tendencies to account for evaporation of convective precipitation.</li>
<li>Calculate shallow convective cloud water.</li>
<li>Calculate convective cloud cover, which is used when pdf-based cloud fraction is used (i.e., pdfcld=.true.).</li>
<li>Separate detrained cloud water into liquid and ice species as a function of temperature only.</li>
<li>Calculate and retain the updraft mass flux for dust transport by cumulus convection.</li>
<li>Calculate the updraft convective mass flux.</li>
<li>save the updraft convective mass flux at cloud top. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="samfshalcnv_8f_source.html#l00062">62</a> of file <a class="el" href="samfshalcnv_8f_source.html">samfshalcnv.f</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
